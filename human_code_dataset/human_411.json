{
    "code": "def main():\n    parser = argparse.ArgumentParser(\n        description=\"Convert various file formats to markdown.\",\n        prog=\"markitdown\",\n        formatter_class=argparse.RawDescriptionHelpFormatter,\n        usage=dedent(\n            \"\"\"\n            SYNTAX:\n\n                markitdown <OPTIONAL: FILENAME>\n                If FILENAME is empty, markitdown reads from stdin.\n\n            EXAMPLE:\n\n                markitdown example.pdf\n\n                OR\n\n                cat example.pdf | markitdown\n\n                OR\n\n                markitdown < example.pdf\n\n                OR to save to a file use\n\n                markitdown example.pdf -o example.md\n\n                OR\n\n                markitdown example.pdf > example.md\n            \"\"\"\n        ).strip(),\n    )\n\n    parser.add_argument(\n        \"-v\",\n        \"--version\",\n        action=\"version\",\n        version=f\"%(prog)s {__version__}\",\n        help=\"show the version number and exit\",\n    )\n\n    parser.add_argument(\n        \"-o\",\n        \"--output\",\n        help=\"Output file name. If not provided, output is written to stdout.\",\n    )\n\n    parser.add_argument(\n        \"-x\",\n        \"--extension\",\n        help=\"Provide a hint about the file extension (e.g., when reading from stdin).\",\n    )\n\n    parser.add_argument(\n        \"-m\",\n        \"--mime-type\",\n        help=\"Provide a hint about the file's MIME type.\",\n    )\n\n    parser.add_argument(\n        \"-c\",\n        \"--charset\",\n        help=\"Provide a hint about the file's charset (e.g, UTF-8).\",\n    )\n\n    parser.add_argument(\n        \"-d\",\n        \"--use-docintel\",\n        action=\"store_true\",\n        help=\"Use Document Intelligence to extract text instead of offline conversion. Requires a valid Document Intelligence Endpoint.\",\n    )\n\n    parser.add_argument(\n        \"-e\",\n        \"--endpoint\",\n        type=str,\n        help=\"Document Intelligence Endpoint. Required if using Document Intelligence.\",\n    )\n\n    parser.add_argument(\n        \"-p\",\n        \"--use-plugins\",\n        action=\"store_true\",\n        help=\"Use 3rd-party plugins to convert files. Use --list-plugins to see installed plugins.\",\n    )\n\n    parser.add_argument(\n        \"--list-plugins\",\n        action=\"store_true\",\n        help=\"List installed 3rd-party plugins. Plugins are loaded when using the -p or --use-plugin option.\",\n    )\n\n    parser.add_argument(\n        \"--keep-data-uris\",\n        action=\"store_true\",\n        help=\"Keep data URIs (like base64-encoded images) in the output. By default, data URIs are truncated.\",\n    )\n\n    parser.add_argument(\"filename\", nargs=\"?\")\n    args = parser.parse_args()\n\n    # Parse the extension hint\n    extension_hint = args.extension\n    if extension_hint is not None:\n        extension_hint = extension_hint.strip().lower()\n        if len(extension_hint) > 0:\n            if not extension_hint.startswith(\".\"):\n                extension_hint = \".\" + extension_hint\n        else:\n            extension_hint = None\n\n    # Parse the mime type\n    mime_type_hint = args.mime_type\n    if mime_type_hint is not None:\n        mime_type_hint = mime_type_hint.strip()\n        if len(mime_type_hint) > 0:\n            if mime_type_hint.count(\"/\") != 1:\n                _exit_with_error(f\"Invalid MIME type: {mime_type_hint}\")\n        else:\n            mime_type_hint = None\n\n    # Parse the charset\n    charset_hint = args.charset\n    if charset_hint is not None:\n        charset_hint = charset_hint.strip()\n        if len(charset_hint) > 0:\n            try:\n                charset_hint = codecs.lookup(charset_hint).name\n            except LookupError:\n                _exit_with_error(f\"Invalid charset: {charset_hint}\")\n        else:\n            charset_hint = None\n\n    stream_info = None\n    if (\n        extension_hint is not None\n        or mime_type_hint is not None\n        or charset_hint is not None\n    ):\n        stream_info = StreamInfo(\n            extension=extension_hint, mimetype=mime_type_hint, charset=charset_hint\n        )\n\n    if args.list_plugins:\n        # List installed plugins, then exit\n        print(\"Installed MarkItDown 3rd-party Plugins:\\n\")\n        plugin_entry_points = list(entry_points(group=\"markitdown.plugin\"))\n        if len(plugin_entry_points) == 0:\n            print(\"  * No 3rd-party plugins installed.\")\n            print(\n                \"\\nFind plugins by searching for the hashtag #markitdown-plugin on GitHub.\\n\"\n            )\n        else:\n            for entry_point in plugin_entry_points:\n                print(f\"  * {entry_point.name:<16}\\t(package: {entry_point.value})\")\n            print(\n                \"\\nUse the -p (or --use-plugins) option to enable 3rd-party plugins.\\n\"\n            )\n        sys.exit(0)\n\n    if args.use_docintel:\n        if args.endpoint is None:\n            _exit_with_error(\n                \"Document Intelligence Endpoint is required when using Document Intelligence.\"\n            )\n        elif args.filename is None:\n            _exit_with_error(\"Filename is required when using Document Intelligence.\")\n\n        markitdown = MarkItDown(\n            enable_plugins=args.use_plugins, docintel_endpoint=args.endpoint\n        )\n    else:\n        markitdown = MarkItDown(enable_plugins=args.use_plugins)\n\n    if args.filename is None:\n        result = markitdown.convert_stream(\n            sys.stdin.buffer,\n            stream_info=stream_info,\n            keep_data_uris=args.keep_data_uris,\n        )\n    else:\n        result = markitdown.convert(\n            args.filename, stream_info=stream_info, keep_data_uris=args.keep_data_uris\n        )\n\n    _handle_output(args, result)",
    "source": "github_repo:microsoft/markitdown",
    "file": "packages/markitdown/src/markitdown/__main__.py",
    "license": "MIT",
    "language": "python"
}