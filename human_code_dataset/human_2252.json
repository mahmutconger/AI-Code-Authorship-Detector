{
    "code": "class FileConfigSource(ConfigSource):\n    def __init__(self, file: TOMLFile) -> None:\n        self._file = file\n\n    @property\n    def name(self) -> str:\n        return str(self._file.path)\n\n    @property\n    def file(self) -> TOMLFile:\n        return self._file\n\n    def get_property(self, key: str) -> Any:\n        keys = key.split(\".\")\n\n        config = self.file.read() if self.file.exists() else {}\n\n        for i, key in enumerate(keys):\n            if key not in config:\n                raise PropertyNotFoundError(f\"Key {'.'.join(keys)} not in config\")\n\n            if i == len(keys) - 1:\n                return config[key]\n\n            config = config[key]\n\n    def add_property(self, key: str, value: Any) -> None:\n        with self.secure() as toml:\n            config: dict[str, Any] = toml\n            keys = key.split(\".\")\n\n            for i, key in enumerate(keys):\n                if key not in config and i < len(keys) - 1:\n                    config[key] = table()\n\n                if i == len(keys) - 1:\n                    config[key] = value\n                    break\n\n                config = config[key]\n\n    def remove_property(self, key: str) -> None:\n        with self.secure() as toml:\n            config: dict[str, Any] = toml\n            keys = key.split(\".\")\n\n            current_config = config\n            for i, key in enumerate(keys):\n                if key not in current_config:\n                    return\n\n                if i == len(keys) - 1:\n                    del current_config[key]\n\n                    break\n\n                current_config = current_config[key]\n\n            current_config = drop_empty_config_category(keys=keys[:-1], config=config)\n            config.clear()\n            config.update(current_config)\n\n    @contextmanager\n    def secure(self) -> Iterator[TOMLDocument]:\n        if self.file.exists():\n            initial_config = self.file.read()\n            config = self.file.read()\n        else:\n            initial_config = document()\n            config = document()\n\n        new_file = not self.file.exists()\n\n        yield config\n\n        try:\n            # Ensuring the file is only readable and writable\n            # by the current user\n            mode = 0o600\n\n            if new_file:\n                self.file.path.touch(mode=mode)\n\n            self.file.write(config)\n        except Exception:\n            self.file.write(initial_config)\n\n            raise",
    "source": "github_repo:python-poetry/poetry",
    "file": "src/poetry/config/file_config_source.py",
    "license": "MIT",
    "language": "python"
}