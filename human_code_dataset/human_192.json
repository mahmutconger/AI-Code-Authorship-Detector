{
    "code": "def _similarity_search_with_score_by_vector(\n        self,\n        embedding: List[float],\n        k: int = 4,\n        filter: Callable[[Document], bool] | None = None,\n        **kwargs: Any,\n    ) -> List[tuple[Document, float, List[float]]]:\n        # get all docs with fixed order in list\n        docs = list(self._database.values())\n\n        if filter is not None:\n            docs = [\n                doc\n                for doc in docs\n                if filter(Document(page_content=doc[\"text\"], metadata=doc[\"metadata\"]))\n            ]\n\n        if not docs:\n            return []\n\n        similarity = cosine_similarity([embedding], [doc[\"vector\"] for doc in docs])[0]\n\n        # get the indices ordered by similarity score\n        top_k_idx = similarity.argsort()[::-1][:k]\n\n        return [\n            (\n                # Document\n                Document(\n                    id=doc_dict[\"id\"],\n                    page_content=doc_dict[\"text\"],\n                    metadata=doc_dict[\"metadata\"],\n                ),\n                # Score\n                float(similarity[idx].item()),\n                # Embedding vector\n                doc_dict[\"vector\"],\n            )\n            for idx in top_k_idx\n            # Assign using walrus operator to avoid multiple lookups\n            if (doc_dict := docs[idx])\n        ]",
    "source": "github_repo:langchain-ai/langchain",
    "file": "libs/cli/langchain_cli/integration_template/integration_template/vectorstores.py",
    "license": "MIT",
    "language": "python"
}