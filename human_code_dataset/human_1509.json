{
    "code": "def record_modify_requests(d: CliDirector):\n    tmux = d.start_session(width=120, height=36)\n    window = tmux.attached_window\n\n    d.start_recording(\"recordings/mitmproxy_modify_requests.cast\")\n    d.message(\n        \"Welcome to the mitmproxy tutorial. In this lesson we cover the modification of intercepted requests.\"\n    )\n    d.pause(1)\n    d.exec(\"mitmproxy\")\n    d.pause(3)\n\n    d.message(\n        \"We configure and use the same interception rule as in the last tutorial.\"\n    )\n    d.message(\n        \"Press `i` to prepopulate mitmproxy’s command prompt, enter the flow filter `~u /Dunedin & ~q`, and press `ENTER`.\"\n    )\n    d.type(\"i\")\n    d.pause(2)\n    d.exec(\"~u /Dunedin & ~q\")\n\n    d.message(\"Let’s generate a request using `curl` in a separate terminal.\")\n\n    pane_top = d.current_pane\n    pane_bottom = window.split_window(attach=True)\n    pane_bottom.resize_pane(height=12)\n\n    d.focus_pane(pane_bottom)\n    d.pause(2)\n\n    d.exec('curl --proxy http://127.0.0.1:8080 \"http://wttr.in/Dunedin?0\"')\n    d.pause(2)\n\n    d.focus_pane(pane_top)\n\n    d.message(\"We now want to modify the intercepted request.\")\n    d.message(\n        \"Put the focus (`>>`) on the intercepted flow. This is already the case in our example.\"\n    )\n\n    d.message(\"Press `ENTER` to open the details view for the intercepted flow.\")\n    d.press_key(\"Enter\")\n\n    d.message(\"Press `e` to edit the intercepted flow.\")\n    d.type(\"e\")\n\n    d.message(\"mitmproxy asks which part to modify.\")\n\n    d.message(\"Select `path` by using your arrow keys and press `ENTER`.\")\n    d.press_key(\"Down\", count=3, pause=0.5)\n    d.pause(1)\n    d.press_key(\"Enter\")\n\n    d.message(\n        \"mitmproxy shows all path components line by line, in our example its just `Dunedin`.\"\n    )\n    d.message(\"Press `ENTER` to modify the selected path component.\")\n    d.press_key(\"Down\", pause=2)\n    d.press_key(\"Enter\")\n\n    d.message(\"Replace `Dunedin` with `Innsbruck`.\")\n    d.press_key(\"BSpace\", count=7, pause=0.5)\n    d.type(\"Innsbruck\", pause=0.5)\n\n    d.message(\"Press `ESC` to confirm your change.\")\n    d.press_key(\"Escape\")\n\n    d.message(\"Press `q` to go back to the flow details view.\")\n    d.type(\"q\")\n\n    d.message(\"Press `a` to resume the intercepted flow.\")\n    d.type(\"a\")\n    d.pause(2)\n\n    d.message(\n        \"You see that the request URL was modified and `wttr.in` replied with the weather report for `Innsbruck`.\"\n    )\n\n    d.message(\"In the next lesson you will learn to replay flows.\")\n    d.save_instructions(\"recordings/mitmproxy_modify_requests_instructions.json\")\n    d.end()",
    "source": "github_repo:mitmproxy/mitmproxy",
    "file": "docs/scripts/clirecording/screenplays.py",
    "license": "MIT",
    "language": "python"
}