{
    "code": "def convert_openai_messages_to_claude(\n    messages: List[ChatCompletionMessageParam],\n) -> Tuple[str, List[Dict[str, Any]]]:\n    \"\"\"\n    Convert OpenAI format messages to Claude format, handling image content properly.\n\n    Args:\n        messages: List of messages in OpenAI format\n\n    Returns:\n        Tuple of (system_prompt, claude_messages)\n    \"\"\"\n    # Deep copy messages to avoid modifying the original list\n    cloned_messages = copy.deepcopy(messages)\n\n    system_prompt = cast(str, cloned_messages[0].get(\"content\"))\n    claude_messages = [dict(message) for message in cloned_messages[1:]]\n\n    for message in claude_messages:\n        if not isinstance(message[\"content\"], list):\n            continue\n\n        for content in message[\"content\"]:  # type: ignore\n            if content[\"type\"] == \"image_url\":\n                content[\"type\"] = \"image\"\n\n                # Extract base64 data and media type from data URL\n                # Example base64 data URL: data:image/png;base64,iVBOR...\n                image_data_url = cast(str, content[\"image_url\"][\"url\"])\n\n                # Process image and split media type and data\n                # so it works with Claude (under 5mb in base64 encoding)\n                (media_type, base64_data) = process_image(image_data_url)\n\n                # Remove OpenAI parameter\n                del content[\"image_url\"]\n\n                content[\"source\"] = {\n                    \"type\": \"base64\",\n                    \"media_type\": media_type,\n                    \"data\": base64_data,\n                }\n\n    return system_prompt, claude_messages",
    "source": "github_repo:abi/screenshot-to-code",
    "file": "backend/models/claude.py",
    "license": "MIT",
    "language": "python"
}