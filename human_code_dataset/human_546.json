{
    "code": "def agent_history_description(self) -> str:\n\t\t\"\"\"Build agent history description from list of items, respecting max_history_items limit\"\"\"\n\t\tif self.max_history_items is None:\n\t\t\t# Include all items\n\t\t\treturn '\\n'.join(item.to_string() for item in self.state.agent_history_items)\n\n\t\ttotal_items = len(self.state.agent_history_items)\n\n\t\t# If we have fewer items than the limit, just return all items\n\t\tif total_items <= self.max_history_items:\n\t\t\treturn '\\n'.join(item.to_string() for item in self.state.agent_history_items)\n\n\t\t# We have more items than the limit, so we need to omit some\n\t\tomitted_count = total_items - self.max_history_items\n\n\t\t# Show first item + omitted message + most recent (max_history_items - 1) items\n\t\t# The omitted message doesn't count against the limit, only real history items do\n\t\trecent_items_count = self.max_history_items - 1  # -1 for first item\n\n\t\titems_to_include = [\n\t\t\tself.state.agent_history_items[0].to_string(),  # Keep first item (initialization)\n\t\t\tf'<sys>[... {omitted_count} previous steps omitted...]</sys>',\n\t\t]\n\t\t# Add most recent items\n\t\titems_to_include.extend([item.to_string() for item in self.state.agent_history_items[-recent_items_count:]])\n\n\t\treturn '\\n'.join(items_to_include)",
    "source": "github_repo:browser-use/browser-use",
    "file": "browser_use/agent/message_manager/service.py",
    "license": "MIT",
    "language": "python"
}