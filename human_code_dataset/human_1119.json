{
    "code": "def _convert_bedrock_response_to_openai_format(self, bedrock_response):\n        # Convert Bedrock response format to OpenAI format\n        content = \"\"\n        if bedrock_response.get(\"output\", {}).get(\"message\", {}).get(\"content\"):\n            content_array = bedrock_response[\"output\"][\"message\"][\"content\"]\n            content = \"\".join(item.get(\"text\", \"\") for item in content_array)\n        if content == \"\":\n            content = \".\"\n\n        # Handle tool calls in response\n        openai_tool_calls = []\n        if bedrock_response.get(\"output\", {}).get(\"message\", {}).get(\"content\"):\n            for content_item in bedrock_response[\"output\"][\"message\"][\"content\"]:\n                if content_item.get(\"toolUse\"):\n                    bedrock_tool_use = content_item[\"toolUse\"]\n                    global CURRENT_TOOLUSE_ID\n                    CURRENT_TOOLUSE_ID = bedrock_tool_use[\"toolUseId\"]\n                    openai_tool_call = {\n                        \"id\": CURRENT_TOOLUSE_ID,\n                        \"type\": \"function\",\n                        \"function\": {\n                            \"name\": bedrock_tool_use[\"name\"],\n                            \"arguments\": json.dumps(bedrock_tool_use[\"input\"]),\n                        },\n                    }\n                    openai_tool_calls.append(openai_tool_call)\n\n        # Construct final OpenAI format response\n        openai_format = {\n            \"id\": f\"chatcmpl-{uuid.uuid4()}\",\n            \"created\": int(time.time()),\n            \"object\": \"chat.completion\",\n            \"system_fingerprint\": None,\n            \"choices\": [\n                {\n                    \"finish_reason\": bedrock_response.get(\"stopReason\", \"end_turn\"),\n                    \"index\": 0,\n                    \"message\": {\n                        \"content\": content,\n                        \"role\": bedrock_response.get(\"output\", {})\n                        .get(\"message\", {})\n                        .get(\"role\", \"assistant\"),\n                        \"tool_calls\": openai_tool_calls\n                        if openai_tool_calls != []\n                        else None,\n                        \"function_call\": None,\n                    },\n                }\n            ],\n            \"usage\": {\n                \"completion_tokens\": bedrock_response.get(\"usage\", {}).get(\n                    \"outputTokens\", 0\n                ),\n                \"prompt_tokens\": bedrock_response.get(\"usage\", {}).get(\n                    \"inputTokens\", 0\n                ),\n                \"total_tokens\": bedrock_response.get(\"usage\", {}).get(\"totalTokens\", 0),\n            },\n        }\n        return OpenAIResponse(openai_format)",
    "source": "github_repo:FoundationAgents/OpenManus",
    "file": "app/bedrock.py",
    "license": "MIT",
    "language": "python"
}