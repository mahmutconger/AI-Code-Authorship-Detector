{
    "code": "def run_recorder() -> None:\n    \"\"\"\n    运行行情录制程序\n\n    该函数是程序的主体，按照以下步骤工作：\n    1. 创建VeighNa核心组件（事件引擎、主引擎）\n    2. 添加交易接口和应用模块\n    3. 设置数据录制规则\n    4. 连接到交易所并开始录制数据\n    \"\"\"\n    # 创建事件引擎，负责系统内各模块间的通信\n    event_engine: EventEngine = EventEngine()\n\n    # 创建主引擎，管理系统功能模块，包括底层接口、上层应用等\n    main_engine: MainEngine = MainEngine(event_engine)\n\n    # 添加CTP接口，连接到期货市场\n    main_engine.add_gateway(CtpGateway)\n\n    # 添加数据录制引擎，用于录制Tick行情入库\n    recorder_engine: RecorderEngine = main_engine.add_app(DataRecorderApp)\n\n    # 定义合约订阅函数\n    def subscribe_data(event: Event) -> None:\n        \"\"\"\n        处理合约推送并订阅行情\n\n        当系统接收到合约信息后，根据预设的交易所和品种过滤条件，\n        自动为符合条件的合约添加行情录制任务。\n\n        参数:\n            event: 包含合约信息的事件对象\n        \"\"\"\n        # 从事件对象中获取合约数据\n        contract: ContractData = event.data\n\n        # 判断合约是否符合录制条件\n        if (\n            contract.exchange in recording_exchanges    # 检查合约所属交易所是否在预设列表中\n            and contract.product in recording_products  # 检查合约品种类型是否在预设列表中\n        ):\n            # 添加该合约的行情录制任务，vt_symbol是VeighNa中的唯一标识符，格式为\"代码.交易所\"\n            recorder_engine.add_tick_recording(contract.vt_symbol)      # 录制Tick数据\n            recorder_engine.add_bar_recording(contract.vt_symbol)       # 录制分钟K线\n\n    # 注册合约事件处理函数，当有新合约信息推送时，会自动调用subscribe_data函数\n    event_engine.register(EVENT_CONTRACT, subscribe_data)\n\n    # 获取日志引擎并设置日志处理\n    log_engine: LogEngine = main_engine.get_engine(\"log\")\n\n    def print_log(event: Event) -> None:\n        \"\"\"\n        处理数据录制模块的日志事件\n\n        将数据录制模块产生的日志信息输出到控制台和日志文件中，\n        便于监控录制过程和排查问题。\n\n        参数:\n            event: 包含日志信息的事件对象\n        \"\"\"\n        log_engine.logger.log(INFO, event.data)\n\n    # 注册日志事件处理函数，当有新的日志推送时，会自动调用print_log函数\n    event_engine.register(EVENT_RECORDER_LOG, print_log)\n\n    # 连接CTP接口并登录，第一个参数是接口设置，第二个参数是接口名称\n    main_engine.connect(ctp_setting, CtpGateway.default_name)\n\n    # 等待30秒，CTP接口连接后需要一段时间来完成初始化\n    sleep(30)\n\n    # 提示用户程序已经开始运行，用户可以根据需要随时退出\n    input(\">>>>>> 高频行情数据录制已启动，正在记录数据。按回车键退出程序 <<<<<<\")\n\n    # 关闭主引擎实现安全退出，避免出现内存中未入库数据的丢失\n    main_engine.close()",
    "source": "github_repo:vnpy/vnpy",
    "file": "examples/data_recorder/data_recorder.py",
    "license": "MIT",
    "language": "python"
}