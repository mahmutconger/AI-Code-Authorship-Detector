{
    "code": "def main():\n    with open(MKDOCS_YML) as f:\n        mkdocs = yaml.safe_load(f)\n\n    # find all pyproject.toml files in the integration folders\n    # each toml file has a toml['tool']['llamahub']['import_path'] key that we need\n    # toml['tool']['llamahub']['class_authors'] contains a list of exposed classes\n    # For each class, we need to create an API reference page\n    search_paths = []\n    for folder in INTEGRATION_FOLDERS:\n        for root, dirs, files in os.walk(folder):\n            if \".venv\" in root:\n                continue\n            for file in files:\n                # check if the current root is in the excluded integration folders\n                if any(\n                    excluded_folder in root\n                    for excluded_folder in EXCLUDED_INTEGRATION_FOLDERS\n                ):\n                    continue\n\n                if file == \"pyproject.toml\":\n                    toml_path = os.path.join(root, file)\n                    if \".venv\" in toml_path:\n                        continue\n\n                    with open(toml_path) as f:\n                        toml_data = toml.load(f)\n\n                    import_path = toml_data[\"tool\"][\"llamahub\"][\"import_path\"]\n                    class_authors = toml_data[\"tool\"][\"llamahub\"][\n                        \"class_authors\"\n                    ]\n                    members = \"\\n\".join(\n                        [\n                            API_REF_MEMBER_TEMPLATE.format(member=member)\n                            for member in class_authors\n                        ]\n                    )\n                    api_ref = API_REF_TEMPLATE.format(\n                        import_path=import_path, members=members\n                    )\n\n                    folder_name = \"/\".join(import_path.split(\".\")[1:-1])\n                    search_paths.append(os.path.join(\"../\", root))\n                    # special cases\n                    if folder_name == \"vector_stores\":\n                        folder_name = \"storage/vector_store\"\n                    elif folder_name == \"indices/managed\":\n                        folder_name = \"indices\"\n                    elif folder_name == \"graph_stores\":\n                        folder_name = \"storage/graph_stores\"\n\n                    full_path = os.path.join(\n                        \"./api_reference/api_reference\", folder_name\n                    )\n                    module_name = import_path.split(\".\")[-1] + \".md\"\n                    os.makedirs(full_path, exist_ok=True)\n                    with open(os.path.join(full_path, module_name), \"w\") as f:\n                        f.write(api_ref)\n\n    # update search paths\n    for i, plugin in enumerate(mkdocs[\"plugins\"]):\n        if \"mkdocstrings\" in plugin:\n            for search_path in search_paths:\n                if (\n                    search_path\n                    not in mkdocs[\"plugins\"][i][\"mkdocstrings\"][\"handlers\"][\n                        \"python\"\n                    ][\"paths\"]\n                ):\n                    mkdocs[\"plugins\"][i][\"mkdocstrings\"][\"handlers\"][\"python\"][\n                        \"paths\"\n                    ].append(search_path)\n\n    # write the updated mkdocs.yml\n    with open(MKDOCS_YML, \"w\") as f:\n        yaml.dump(mkdocs, f)\n\n    # copy over extra files\n    os.system(\"cp ../CHANGELOG.md ./src/content/docs/framework/CHANGELOG.md\")\n\n    # Ensure CHANGELOG had the proper astro header\n    changelog_contents = \"\"\n    with open(\"./src/content/docs/framework/CHANGELOG.md\", \"r\") as f:\n        changelog_contents = f.read()\n\n    astro_header = \"---\\ntitle: ChangeLog\\n---\"\n    changelog_contents = changelog_contents.replace(\n        \"# ChangeLog\\n\", astro_header\n    )\n\n    with open(\"./src/content/docs/framework/CHANGELOG.md\", \"w\") as f:\n        f.write(changelog_contents)",
    "source": "github_repo:run-llama/llama_index",
    "file": "docs/scripts/prepare_for_build.py",
    "license": "MIT",
    "language": "python"
}