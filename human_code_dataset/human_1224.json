{
    "code": "class RedisTaskManager(TaskManager):\n    def __init__(self, max_concurrent_tasks: int, redis_url: str):\n        self.redis_client = redis.Redis.from_url(redis_url)\n        super().__init__(max_concurrent_tasks)\n\n    def create_queue(self):\n        return \"task_queue\"\n\n    def enqueue(self, task: Dict):\n        task_with_serializable_params = task.copy()\n\n        if \"params\" in task[\"kwargs\"] and isinstance(\n            task[\"kwargs\"][\"params\"], VideoParams\n        ):\n            task_with_serializable_params[\"kwargs\"][\"params\"] = task[\"kwargs\"][\n                \"params\"\n            ].dict()\n\n        # 将函数对象转换为其名称\n        task_with_serializable_params[\"func\"] = task[\"func\"].__name__\n        self.redis_client.rpush(self.queue, json.dumps(task_with_serializable_params))\n\n    def dequeue(self):\n        task_json = self.redis_client.lpop(self.queue)\n        if task_json:\n            task_info = json.loads(task_json)\n            # 将函数名称转换回函数对象\n            task_info[\"func\"] = FUNC_MAP[task_info[\"func\"]]\n\n            if \"params\" in task_info[\"kwargs\"] and isinstance(\n                task_info[\"kwargs\"][\"params\"], dict\n            ):\n                task_info[\"kwargs\"][\"params\"] = VideoParams(\n                    **task_info[\"kwargs\"][\"params\"]\n                )\n\n            return task_info\n        return None\n\n    def is_queue_empty(self):\n        return self.redis_client.llen(self.queue) == 0",
    "source": "github_repo:harry0703/MoneyPrinterTurbo",
    "file": "app/controllers/manager/redis_manager.py",
    "license": "MIT",
    "language": "python"
}