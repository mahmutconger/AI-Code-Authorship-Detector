{
    "code": "def download_template_from_github(ai_assistant: str, download_dir: Path, *, script_type: str = \"sh\", verbose: bool = True, show_progress: bool = True, client: httpx.Client = None, debug: bool = False, github_token: str = None) -> Tuple[Path, dict]:\n    repo_owner = \"github\"\n    repo_name = \"spec-kit\"\n    if client is None:\n        client = httpx.Client(verify=ssl_context)\n\n    if verbose:\n        console.print(\"[cyan]Fetching latest release information...[/cyan]\")\n    api_url = f\"https://api.github.com/repos/{repo_owner}/{repo_name}/releases/latest\"\n\n    try:\n        response = client.get(\n            api_url,\n            timeout=30,\n            follow_redirects=True,\n            headers=_github_auth_headers(github_token),\n        )\n        status = response.status_code\n        if status != 200:\n            # Format detailed error message with rate-limit info\n            error_msg = _format_rate_limit_error(status, response.headers, api_url)\n            if debug:\n                error_msg += f\"\\n\\n[dim]Response body (truncated 500):[/dim]\\n{response.text[:500]}\"\n            raise RuntimeError(error_msg)\n        try:\n            release_data = response.json()\n        except ValueError as je:\n            raise RuntimeError(f\"Failed to parse release JSON: {je}\\nRaw (truncated 400): {response.text[:400]}\")\n    except Exception as e:\n        console.print(f\"[red]Error fetching release information[/red]\")\n        console.print(Panel(str(e), title=\"Fetch Error\", border_style=\"red\"))\n        raise typer.Exit(1)\n\n    assets = release_data.get(\"assets\", [])\n    pattern = f\"spec-kit-template-{ai_assistant}-{script_type}\"\n    matching_assets = [\n        asset for asset in assets\n        if pattern in asset[\"name\"] and asset[\"name\"].endswith(\".zip\")\n    ]\n\n    asset = matching_assets[0] if matching_assets else None\n\n    if asset is None:\n        console.print(f\"[red]No matching release asset found[/red] for [bold]{ai_assistant}[/bold] (expected pattern: [bold]{pattern}[/bold])\")\n        asset_names = [a.get('name', '?') for a in assets]\n        console.print(Panel(\"\\n\".join(asset_names) or \"(no assets)\", title=\"Available Assets\", border_style=\"yellow\"))\n        raise typer.Exit(1)\n\n    download_url = asset[\"browser_download_url\"]\n    filename = asset[\"name\"]\n    file_size = asset[\"size\"]\n\n    if verbose:\n        console.print(f\"[cyan]Found template:[/cyan] {filename}\")\n        console.print(f\"[cyan]Size:[/cyan] {file_size:,} bytes\")\n        console.print(f\"[cyan]Release:[/cyan] {release_data['tag_name']}\")\n\n    zip_path = download_dir / filename\n    if verbose:\n        console.print(f\"[cyan]Downloading template...[/cyan]\")\n\n    try:\n        with client.stream(\n            \"GET\",\n            download_url,\n            timeout=60,\n            follow_redirects=True,\n            headers=_github_auth_headers(github_token),\n        ) as response:\n            if response.status_code != 200:\n                # Handle rate-limiting on download as well\n                error_msg = _format_rate_limit_error(response.status_code, response.headers, download_url)\n                if debug:\n                    error_msg += f\"\\n\\n[dim]Response body (truncated 400):[/dim]\\n{response.text[:400]}\"\n                raise RuntimeError(error_msg)\n            total_size = int(response.headers.get('content-length', 0))\n            with open(zip_path, 'wb') as f:\n                if total_size == 0:\n                    for chunk in response.iter_bytes(chunk_size=8192):\n                        f.write(chunk)\n                else:\n                    if show_progress:\n                        with Progress(\n                            SpinnerColumn(),\n                            TextColumn(\"[progress.description]{task.description}\"),\n                            TextColumn(\"[progress.percentage]{task.percentage:>3.0f}%\"),\n                            console=console,\n                        ) as progress:\n                            task = progress.add_task(\"Downloading...\", total=total_size)\n                            downloaded = 0\n                            for chunk in response.iter_bytes(chunk_size=8192):\n                                f.write(chunk)\n                                downloaded += len(chunk)\n                                progress.update(task, completed=downloaded)\n                    else:\n                        for chunk in response.iter_bytes(chunk_size=8192):\n                            f.write(chunk)\n    except Exception as e:\n        console.print(f\"[red]Error downloading template[/red]\")\n        detail = str(e)\n        if zip_path.exists():\n            zip_path.unlink()\n        console.print(Panel(detail, title=\"Download Error\", border_style=\"red\"))\n        raise typer.Exit(1)\n    if verbose:\n        console.print(f\"Downloaded: {filename}\")\n    metadata = {\n        \"filename\": filename,\n        \"size\": file_size,\n        \"release\": release_data[\"tag_name\"],\n        \"asset_url\": download_url\n    }\n    return zip_path, metadata",
    "source": "github_repo:github/spec-kit",
    "file": "src/specify_cli/__init__.py",
    "license": "MIT",
    "language": "python"
}