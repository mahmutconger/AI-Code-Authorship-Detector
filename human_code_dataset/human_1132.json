{
    "code": "class Config:\n    _instance = None\n    _lock = threading.Lock()\n    _initialized = False\n\n    def __new__(cls):\n        if cls._instance is None:\n            with cls._lock:\n                if cls._instance is None:\n                    cls._instance = super().__new__(cls)\n        return cls._instance\n\n    def __init__(self):\n        if not self._initialized:\n            with self._lock:\n                if not self._initialized:\n                    self._config = None\n                    self._load_initial_config()\n                    self._initialized = True\n\n    @staticmethod\n    def _get_config_path() -> Path:\n        root = PROJECT_ROOT\n        config_path = root / \"config\" / \"config.toml\"\n        if config_path.exists():\n            return config_path\n        example_path = root / \"config\" / \"config.example.toml\"\n        if example_path.exists():\n            return example_path\n        raise FileNotFoundError(\"No configuration file found in config directory\")\n\n    def _load_config(self) -> dict:\n        config_path = self._get_config_path()\n        with config_path.open(\"rb\") as f:\n            return tomllib.load(f)\n\n    def _load_initial_config(self):\n        raw_config = self._load_config()\n        base_llm = raw_config.get(\"llm\", {})\n        llm_overrides = {\n            k: v for k, v in raw_config.get(\"llm\", {}).items() if isinstance(v, dict)\n        }\n\n        default_settings = {\n            \"model\": base_llm.get(\"model\"),\n            \"base_url\": base_llm.get(\"base_url\"),\n            \"api_key\": base_llm.get(\"api_key\"),\n            \"max_tokens\": base_llm.get(\"max_tokens\", 4096),\n            \"max_input_tokens\": base_llm.get(\"max_input_tokens\"),\n            \"temperature\": base_llm.get(\"temperature\", 1.0),\n            \"api_type\": base_llm.get(\"api_type\", \"\"),\n            \"api_version\": base_llm.get(\"api_version\", \"\"),\n        }\n\n        # handle browser config.\n        browser_config = raw_config.get(\"browser\", {})\n        browser_settings = None\n\n        if browser_config:\n            # handle proxy settings.\n            proxy_config = browser_config.get(\"proxy\", {})\n            proxy_settings = None\n\n            if proxy_config and proxy_config.get(\"server\"):\n                proxy_settings = ProxySettings(\n                    **{\n                        k: v\n                        for k, v in proxy_config.items()\n                        if k in [\"server\", \"username\", \"password\"] and v\n                    }\n                )\n\n            # filter valid browser config parameters.\n            valid_browser_params = {\n                k: v\n                for k, v in browser_config.items()\n                if k in BrowserSettings.__annotations__ and v is not None\n            }\n\n            # if there is proxy settings, add it to the parameters.\n            if proxy_settings:\n                valid_browser_params[\"proxy\"] = proxy_settings\n\n            # only create BrowserSettings when there are valid parameters.\n            if valid_browser_params:\n                browser_settings = BrowserSettings(**valid_browser_params)\n\n        search_config = raw_config.get(\"search\", {})\n        search_settings = None\n        if search_config:\n            search_settings = SearchSettings(**search_config)\n        sandbox_config = raw_config.get(\"sandbox\", {})\n        if sandbox_config:\n            sandbox_settings = SandboxSettings(**sandbox_config)\n        else:\n            sandbox_settings = SandboxSettings()\n        daytona_config = raw_config.get(\"daytona\", {})\n        if daytona_config:\n            daytona_settings = DaytonaSettings(**daytona_config)\n        else:\n            daytona_settings = DaytonaSettings()\n\n        mcp_config = raw_config.get(\"mcp\", {})\n        mcp_settings = None\n        if mcp_config:\n            # Load server configurations from JSON\n            mcp_config[\"servers\"] = MCPSettings.load_server_config()\n            mcp_settings = MCPSettings(**mcp_config)\n        else:\n            mcp_settings = MCPSettings(servers=MCPSettings.load_server_config())\n\n        run_flow_config = raw_config.get(\"runflow\")\n        if run_flow_config:\n            run_flow_settings = RunflowSettings(**run_flow_config)\n        else:\n            run_flow_settings = RunflowSettings()\n        config_dict = {\n            \"llm\": {\n                \"default\": default_settings,\n                **{\n                    name: {**default_settings, **override_config}\n                    for name, override_config in llm_overrides.items()\n                },\n            },\n            \"sandbox\": sandbox_settings,\n            \"browser_config\": browser_settings,\n            \"search_config\": search_settings,\n            \"mcp_config\": mcp_settings,\n            \"run_flow_config\": run_flow_settings,\n            \"daytona_config\": daytona_settings,\n        }\n\n        self._config = AppConfig(**config_dict)\n\n    @property\n    def llm(self) -> Dict[str, LLMSettings]:\n        return self._config.llm\n\n    @property\n    def sandbox(self) -> SandboxSettings:\n        return self._config.sandbox\n\n    @property\n    def daytona(self) -> DaytonaSettings:\n        return self._config.daytona_config\n\n    @property\n    def browser_config(self) -> Optional[BrowserSettings]:\n        return self._config.browser_config\n\n    @property\n    def search_config(self) -> Optional[SearchSettings]:\n        return self._config.search_config\n\n    @property\n    def mcp_config(self) -> MCPSettings:\n        \"\"\"Get the MCP configuration\"\"\"\n        return self._config.mcp_config\n\n    @property\n    def run_flow_config(self) -> RunflowSettings:\n        \"\"\"Get the Run Flow configuration\"\"\"\n        return self._config.run_flow_config\n\n    @property\n    def workspace_root(self) -> Path:\n        \"\"\"Get the workspace root directory\"\"\"\n        return WORKSPACE_ROOT\n\n    @property\n    def root_path(self) -> Path:\n        \"\"\"Get the root path of the application\"\"\"\n        return PROJECT_ROOT",
    "source": "github_repo:FoundationAgents/OpenManus",
    "file": "app/config.py",
    "license": "MIT",
    "language": "python"
}