{
    "code": "def reply(self, query, context=None):\n        # acquire reply content\n        if context.type == ContextType.TEXT:\n            logger.info(\"[QWEN] query={}\".format(query))\n\n            session_id = context[\"session_id\"]\n            reply = None\n            clear_memory_commands = conf().get(\"clear_memory_commands\", [\"#清除记忆\"])\n            if query in clear_memory_commands:\n                self.sessions.clear_session(session_id)\n                reply = Reply(ReplyType.INFO, \"记忆已清除\")\n            elif query == \"#清除所有\":\n                self.sessions.clear_all_session()\n                reply = Reply(ReplyType.INFO, \"所有人记忆已清除\")\n            elif query == \"#更新配置\":\n                load_config()\n                reply = Reply(ReplyType.INFO, \"配置已更新\")\n            if reply:\n                return reply\n            session = self.sessions.session_query(query, session_id)\n            logger.debug(\"[QWEN] session query={}\".format(session.messages))\n\n            reply_content = self.reply_text(session)\n            logger.debug(\n                \"[QWEN] new_query={}, session_id={}, reply_cont={}, completion_tokens={}\".format(\n                    session.messages,\n                    session_id,\n                    reply_content[\"content\"],\n                    reply_content[\"completion_tokens\"],\n                )\n            )\n            if reply_content[\"completion_tokens\"] == 0 and len(reply_content[\"content\"]) > 0:\n                reply = Reply(ReplyType.ERROR, reply_content[\"content\"])\n            elif reply_content[\"completion_tokens\"] > 0:\n                self.sessions.session_reply(reply_content[\"content\"], session_id, reply_content[\"total_tokens\"])\n                reply = Reply(ReplyType.TEXT, reply_content[\"content\"])\n            else:\n                reply = Reply(ReplyType.ERROR, reply_content[\"content\"])\n                logger.debug(\"[QWEN] reply {} used 0 tokens.\".format(reply_content))\n            return reply\n\n        else:\n            reply = Reply(ReplyType.ERROR, \"Bot不支持处理{}类型的消息\".format(context.type))\n            return reply",
    "source": "github_repo:zhayujie/chatgpt-on-wechat",
    "file": "bot/ali/ali_qwen_bot.py",
    "license": "MIT",
    "language": "python"
}