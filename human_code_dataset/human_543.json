{
    "code": "def _log_format_message_line(message: BaseMessage, content: str, is_last_message: bool, terminal_width: int) -> list[str]:\n\t\"\"\"Format a single message for logging display\"\"\"\n\ttry:\n\t\tlines = []\n\n\t\t# Get emoji and token info\n\t\temoji = _log_get_message_emoji(message)\n\t\t# token_str = str(message.metadata.tokens).rjust(4)\n\t\t# TODO: fix the token count\n\t\ttoken_str = '??? (TODO)'\n\t\tprefix = f'{emoji}[{token_str}]: '\n\n\t\t# Calculate available width (emoji=2 visual cols + [token]: =8 chars)\n\t\tcontent_width = terminal_width - 10\n\n\t\t# Handle last message wrapping\n\t\tif is_last_message and len(content) > content_width:\n\t\t\t# Find a good break point\n\t\t\tbreak_point = content.rfind(' ', 0, content_width)\n\t\t\tif break_point > content_width * 0.7:  # Keep at least 70% of line\n\t\t\t\tfirst_line = content[:break_point]\n\t\t\t\trest = content[break_point + 1 :]\n\t\t\telse:\n\t\t\t\t# No good break point, just truncate\n\t\t\t\tfirst_line = content[:content_width]\n\t\t\t\trest = content[content_width:]\n\n\t\t\tlines.append(prefix + first_line)\n\n\t\t\t# Second line with 10-space indent\n\t\t\tif rest:\n\t\t\t\tif len(rest) > terminal_width - 10:\n\t\t\t\t\trest = rest[: terminal_width - 10]\n\t\t\t\tlines.append(' ' * 10 + rest)\n\t\telse:\n\t\t\t# Single line - truncate if needed\n\t\t\tif len(content) > content_width:\n\t\t\t\tcontent = content[:content_width]\n\t\t\tlines.append(prefix + content)\n\n\t\treturn lines\n\texcept Exception as e:\n\t\tlogger.warning(f'Failed to format message line for logging: {e}')\n\t\t# Return a simple fallback line\n\t\treturn ['‚ùì[   ?]: [Error formatting message]']",
    "source": "github_repo:browser-use/browser-use",
    "file": "browser_use/agent/message_manager/service.py",
    "license": "MIT",
    "language": "python"
}