{
    "code": "def dependents_graph() -> dict:\n    \"\"\"Construct a mapping of package -> dependents\n\n    Done such that we can run tests on all dependents of a package when a change is made.\n    \"\"\"\n    dependents = defaultdict(set)\n\n    for path in glob.glob(\"./libs/**/pyproject.toml\", recursive=True):\n        if \"template\" in path:\n            continue\n\n        # load regular and test deps from pyproject.toml\n        with open(path, \"rb\") as f:\n            pyproject = tomllib.load(f)\n\n        pkg_dir = \"libs\" + \"/\".join(path.split(\"libs\")[1].split(\"/\")[:-1])\n        for dep in [\n            *pyproject[\"project\"][\"dependencies\"],\n            *pyproject[\"dependency-groups\"][\"test\"],\n        ]:\n            requirement = Requirement(dep)\n            package_name = requirement.name\n            if \"langchain\" in dep:\n                dependents[package_name].add(pkg_dir)\n                continue\n\n        # load extended deps from extended_testing_deps.txt\n        package_path = Path(path).parent\n        extended_requirement_path = package_path / \"extended_testing_deps.txt\"\n        if extended_requirement_path.exists():\n            with open(extended_requirement_path, \"r\") as f:\n                extended_deps = f.read().splitlines()\n                for depline in extended_deps:\n                    if depline.startswith(\"-e \"):\n                        # editable dependency\n                        assert depline.startswith(\"-e ../partners/\"), (\n                            \"Extended test deps should only editable install partner packages\"\n                        )\n                        partner = depline.split(\"partners/\")[1]\n                        dep = f\"langchain-{partner}\"\n                    else:\n                        dep = depline.split(\"==\")[0]\n\n                    if \"langchain\" in dep:\n                        dependents[dep].add(pkg_dir)\n\n    for k in dependents:\n        for partner in IGNORED_PARTNERS:\n            if f\"libs/partners/{partner}\" in dependents[k]:\n                dependents[k].remove(f\"libs/partners/{partner}\")\n    return dependents",
    "source": "github_repo:langchain-ai/langchain",
    "file": ".github/scripts/check_diff.py",
    "license": "MIT",
    "language": "python"
}