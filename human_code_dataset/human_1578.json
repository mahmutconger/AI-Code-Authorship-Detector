{
    "code": "def blackify(base_branch: str, black_command: str, logger: logging.Logger) -> int:\n    current_branch = git(\"branch\", \"--show-current\")\n\n    if not current_branch or base_branch == current_branch:\n        logger.error(\"You need to check out a feature branch to work on\")\n        return 1\n\n    if not os.path.exists(\".git\"):\n        logger.error(\"Run me in the root of your repo\")\n        return 1\n\n    merge_base = git(\"merge-base\", \"HEAD\", base_branch)\n    if not merge_base:\n        logger.error(\n            f\"Could not find a common commit for current head and {base_branch}\"\n        )\n        return 1\n\n    commits = git(\n        \"log\", \"--reverse\", \"--pretty=format:%H\", f\"{merge_base}~1..HEAD\"\n    ).split()\n    for commit in commits:\n        git(\"checkout\", commit, f\"-b{commit}-black\")\n        check_output(black_command, shell=True)\n        git(\"commit\", \"-aqm\", \"blackify\")\n\n    git(\"checkout\", base_branch, f\"-b{current_branch}-black\")\n\n    for last_commit, commit in zip(commits, commits[1:], strict=False):\n        allow_empty = (\n            b\"--allow-empty\" in run([\"git\", \"apply\", \"-h\"], stdout=PIPE).stdout\n        )\n        quiet = b\"--quiet\" in run([\"git\", \"apply\", \"-h\"], stdout=PIPE).stdout\n        git_diff = Popen(\n            [\n                \"git\",\n                \"diff\",\n                \"--binary\",\n                \"--find-copies\",\n                f\"{last_commit}-black..{commit}-black\",\n            ],\n            stdout=PIPE,\n        )\n        git_apply = Popen(\n            [\n                \"git\",\n                \"apply\",\n            ]\n            + ([\"--quiet\"] if quiet else [])\n            + [\n                \"-3\",\n                \"--intent-to-add\",\n            ]\n            + ([\"--allow-empty\"] if allow_empty else [])\n            + [\n                \"-\",\n            ],\n            stdin=git_diff.stdout,\n        )\n        if git_diff.stdout is not None:\n            git_diff.stdout.close()\n        git_apply.communicate()\n        git(\"commit\", \"--allow-empty\", \"-aqC\", commit)\n\n    for commit in commits:\n        git(\"branch\", \"-qD\", f\"{commit}-black\")\n\n    return 0",
    "source": "github_repo:psf/black",
    "file": "scripts/migrate-black.py",
    "license": "MIT",
    "language": "python"
}