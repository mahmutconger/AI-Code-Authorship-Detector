{
    "code": "def device_config(self) -> tuple:\n        if torch.cuda.is_available():\n            if self.has_xpu():\n                self.device = self.instead = \"xpu:0\"\n                self.is_half = True\n            i_device = int(self.device.split(\":\")[-1])\n            self.gpu_name = torch.cuda.get_device_name(i_device)\n            if (\n                (\"16\" in self.gpu_name and \"V100\" not in self.gpu_name.upper())\n                or \"P40\" in self.gpu_name.upper()\n                or \"P10\" in self.gpu_name.upper()\n                or \"1060\" in self.gpu_name\n                or \"1070\" in self.gpu_name\n                or \"1080\" in self.gpu_name\n            ):\n                logger.info(\"Found GPU %s, force to fp32\", self.gpu_name)\n                self.is_half = False\n                self.use_fp32_config()\n            else:\n                logger.info(\"Found GPU %s\", self.gpu_name)\n            self.gpu_mem = int(\n                torch.cuda.get_device_properties(i_device).total_memory\n                / 1024\n                / 1024\n                / 1024\n                + 0.4\n            )\n            if self.gpu_mem <= 4:\n                self.preprocess_per = 3.0\n        elif self.has_mps():\n            logger.info(\"No supported Nvidia GPU found\")\n            self.device = self.instead = \"mps\"\n            self.is_half = False\n            self.use_fp32_config()\n        else:\n            logger.info(\"No supported Nvidia GPU found\")\n            self.device = self.instead = \"cpu\"\n            self.is_half = False\n            self.use_fp32_config()\n\n        if self.n_cpu == 0:\n            self.n_cpu = cpu_count()\n\n        if self.is_half:\n            # 6G显存配置\n            x_pad = 3\n            x_query = 10\n            x_center = 60\n            x_max = 65\n        else:\n            # 5G显存配置\n            x_pad = 1\n            x_query = 6\n            x_center = 38\n            x_max = 41\n\n        if self.gpu_mem is not None and self.gpu_mem <= 4:\n            x_pad = 1\n            x_query = 5\n            x_center = 30\n            x_max = 32\n        if self.dml:\n            logger.info(\"Use DirectML instead\")\n            if (\n                os.path.exists(\n                    \"runtime\\Lib\\site-packages\\onnxruntime\\capi\\DirectML.dll\"\n                )\n                == False\n            ):\n                try:\n                    os.rename(\n                        \"runtime\\Lib\\site-packages\\onnxruntime\",\n                        \"runtime\\Lib\\site-packages\\onnxruntime-cuda\",\n                    )\n                except:\n                    pass\n                try:\n                    os.rename(\n                        \"runtime\\Lib\\site-packages\\onnxruntime-dml\",\n                        \"runtime\\Lib\\site-packages\\onnxruntime\",\n                    )\n                except:\n                    pass\n            # if self.device != \"cpu\":\n            import torch_directml\n\n            self.device = torch_directml.device(torch_directml.default_device())\n            self.is_half = False\n        else:\n            if self.instead:\n                logger.info(f\"Use {self.instead} instead\")\n            if (\n                os.path.exists(\n                    \"runtime\\Lib\\site-packages\\onnxruntime\\capi\\onnxruntime_providers_cuda.dll\"\n                )\n                == False\n            ):\n                try:\n                    os.rename(\n                        \"runtime\\Lib\\site-packages\\onnxruntime\",\n                        \"runtime\\Lib\\site-packages\\onnxruntime-dml\",\n                    )\n                except:\n                    pass\n                try:\n                    os.rename(\n                        \"runtime\\Lib\\site-packages\\onnxruntime-cuda\",\n                        \"runtime\\Lib\\site-packages\\onnxruntime\",\n                    )\n                except:\n                    pass\n        logger.info(\n            \"Half-precision floating-point: %s, device: %s\"\n            % (self.is_half, self.device)\n        )\n        return x_pad, x_query, x_center, x_max",
    "source": "github_repo:RVC-Project/Retrieval-based-Voice-Conversion-WebUI",
    "file": "configs/config.py",
    "license": "MIT",
    "language": "python"
}