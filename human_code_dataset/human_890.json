{
    "code": "class CliAgent(BaseAgent):\n    \"\"\"\n    The `CliAgent` class is responsible for managing the lifecycle of code generation and improvement\n    using an AI model. It orchestrates the generation of new code and the improvement of existing code\n    based on given prompts and utilizes a memory system and execution environment for processing.\n\n    Parameters\n    ----------\n    memory : BaseMemory\n        An instance of a class that adheres to the BaseMemory interface, used for storing and retrieving\n        information during the code generation process.\n    execution_env : BaseExecutionEnv\n        An instance of a class that adheres to the BaseExecutionEnv interface, used for executing code\n        and managing the execution environment.\n    ai : AI, optional\n        An instance of the AI class that manages calls to the language model. If not provided, a default\n        instance is created.\n    code_gen_fn : CodeGenType, optional\n        A callable that takes an AI instance, a prompt, and a memory instance to generate code. Defaults\n        to the `gen_code` function.\n    improve_fn : ImproveType, optional\n        A callable that takes an AI instance, a prompt, a FilesDict instance, and a memory instance to\n        improve code. Defaults to the `improve` function.\n    process_code_fn : CodeProcessor, optional\n        A callable that takes an AI instance, an execution environment, and a FilesDict instance to\n        process code. Defaults to the `execute_entrypoint` function.\n    preprompts_holder : PrepromptsHolder, optional\n        An instance of PrepromptsHolder that manages preprompt templates. If not provided, a default\n        instance is created using the PREPROMPTS_PATH.\n\n    Attributes\n    ----------\n    memory : BaseMemory\n        The memory instance where the agent stores and retrieves information.\n    execution_env : BaseExecutionEnv\n        The execution environment instance where the agent executes and manages code.\n    ai : AI\n        The AI instance used for interacting with the language model.\n    code_gen_fn : CodeGenType\n        The function used for generating code.\n    improve_fn : ImproveType\n        The function used for improving code.\n    process_code_fn : CodeProcessor\n        The function used for processing code.\n    preprompts_holder : PrepromptsHolder\n        The holder for preprompt templates.\n    \"\"\"\n\n    def __init__(\n        self,\n        memory: BaseMemory,\n        execution_env: BaseExecutionEnv,\n        ai: AI = None,\n        code_gen_fn: CodeGenType = gen_code,\n        improve_fn: ImproveType = improve_fn,\n        process_code_fn: CodeProcessor = execute_entrypoint,\n        preprompts_holder: PrepromptsHolder = None,\n    ):\n        self.memory = memory\n        self.execution_env = execution_env\n        self.ai = ai or AI()\n        self.code_gen_fn = code_gen_fn\n        self.process_code_fn = process_code_fn\n        self.improve_fn = improve_fn\n        self.preprompts_holder = preprompts_holder or PrepromptsHolder(PREPROMPTS_PATH)\n\n    @classmethod\n    def with_default_config(\n        cls,\n        memory: DiskMemory,\n        execution_env: DiskExecutionEnv,\n        ai: AI = None,\n        code_gen_fn: CodeGenType = gen_code,\n        improve_fn: ImproveType = improve_fn,\n        process_code_fn: CodeProcessor = execute_entrypoint,\n        preprompts_holder: PrepromptsHolder = None,\n        diff_timeout=3,\n    ):\n        \"\"\"\n        Creates a new instance of CliAgent with default configurations for memory, execution environment,\n        AI, and other functional parameters.\n\n        Parameters\n        ----------\n        memory : DiskMemory\n            An instance of DiskMemory for storing and retrieving information.\n        execution_env : DiskExecutionEnv\n            An instance of DiskExecutionEnv for executing code.\n        ai : AI, optional\n            An instance of AI for interacting with the language model. Defaults to None, which will create\n            a new AI instance.\n        code_gen_fn : CodeGenType, optional\n            A function for generating code. Defaults to `gen_code`.\n        improve_fn : ImproveType, optional\n            A function for improving code. Defaults to `improve`.\n        process_code_fn : CodeProcessor, optional\n            A function for processing code. Defaults to `execute_entrypoint`.\n        preprompts_holder : PrepromptsHolder, optional\n            An instance of PrepromptsHolder for managing preprompt templates. Defaults to None, which will\n            create a new PrepromptsHolder instance using PREPROMPTS_PATH.\n\n        Returns\n        -------\n        CliAgent\n            An instance of CliAgent configured with the provided or default parameters.\n        \"\"\"\n        return cls(\n            memory=memory,\n            execution_env=execution_env,\n            ai=ai,\n            code_gen_fn=code_gen_fn,\n            process_code_fn=process_code_fn,\n            improve_fn=improve_fn,\n            preprompts_holder=preprompts_holder or PrepromptsHolder(PREPROMPTS_PATH),\n        )\n\n    def init(self, prompt: Prompt) -> FilesDict:\n        \"\"\"\n        Generates a new piece of code using the AI and step bundle based on the provided prompt.\n\n        Parameters\n        ----------\n        prompt : str\n            A string prompt that guides the code generation process.\n\n        Returns\n        -------\n        FilesDict\n            An instance of the `FilesDict` class containing the generated code.\n        \"\"\"\n\n        files_dict = self.code_gen_fn(\n            self.ai, prompt, self.memory, self.preprompts_holder\n        )\n        entrypoint = gen_entrypoint(\n            self.ai, prompt, files_dict, self.memory, self.preprompts_holder\n        )\n        combined_dict = {**files_dict, **entrypoint}\n        files_dict = FilesDict(combined_dict)\n        files_dict = self.process_code_fn(\n            self.ai,\n            self.execution_env,\n            files_dict,\n            preprompts_holder=self.preprompts_holder,\n            prompt=prompt,\n            memory=self.memory,\n        )\n        return files_dict\n\n    def improve(\n        self,\n        files_dict: FilesDict,\n        prompt: Prompt,\n        execution_command: Optional[str] = None,\n        diff_timeout=3,\n    ) -> FilesDict:\n        \"\"\"\n        Improves an existing piece of code using the AI and step bundle based on the provided prompt.\n\n        Parameters\n        ----------\n        files_dict : FilesDict\n            An instance of `FilesDict` containing the code to be improved.\n        prompt : str\n            A string prompt that guides the code improvement process.\n        execution_command : str, optional\n            An optional command to execute the code. If not provided, the default execution command is used.\n\n        Returns\n        -------\n        FilesDict\n            An instance of the `FilesDict` class containing the improved code.\n        \"\"\"\n\n        files_dict = self.improve_fn(\n            self.ai,\n            prompt,\n            files_dict,\n            self.memory,\n            self.preprompts_holder,\n            diff_timeout=diff_timeout,\n        )\n        # entrypoint = gen_entrypoint(\n        #     self.ai, prompt, files_dict, self.memory, self.preprompts_holder\n        # )\n        # combined_dict = {**files_dict, **entrypoint}\n        # files_dict = FilesDict(combined_dict)\n        # files_dict = self.process_code_fn(\n        #     self.ai,\n        #     self.execution_env,\n        #     files_dict,\n        #     preprompts_holder=self.preprompts_holder,\n        #     prompt=prompt,\n        #     memory=self.memory,\n        # )\n\n        return files_dict",
    "source": "github_repo:AntonOsika/gpt-engineer",
    "file": "gpt_engineer/applications/cli/cli_agent.py",
    "license": "MIT",
    "language": "python"
}