{
    "code": "def main():\n    inf = json.loads(sys.argv[1])\n    vdir, fn = os.path.split(inf[\"vp\"])\n\n    try:\n        fn, ext = fn.rsplit(\".\", 1)\n    except:\n        # no file extension; pretend it's \"bin\"\n        ext = \"bin\"\n\n    ext = ext.lower()\n\n    # this function must end by printing the action to perform;\n    # that's handled by the print(json.dumps(... at the bottom\n    #\n    # the action can contain the following keys:\n    # \"vp\" is the folder URL to move the upload to,\n    # \"ap\" is the filesystem-path to move it to (but \"vp\" is safer),\n    # \"fn\" overrides the final filename to use\n\n    ##\n    ## some example actions to take; pick one by\n    ## selecting it inside the print at the end:\n    ##\n\n    # move all uploads to one specific folder\n    into_junk = {\"vp\": \"/junk\"}\n\n    # create a subfolder named after the filetype and move it into there\n    into_subfolder = {\"vp\": ext}\n\n    # move it into a toplevel folder named after the filetype\n    into_toplevel = {\"vp\": \"/\" + ext}\n\n    # move it into a filetype-named folder next to the target folder\n    into_sibling = {\"vp\": \"../\" + ext}\n\n    # move images into \"/just/pics\", vids into \"/just/vids\",\n    # music into \"/just/tunes\", and anything else as-is\n    if ext in PICS.split():\n        by_category = {\"vp\": \"/just/pics\"}\n    elif ext in VIDS.split():\n        by_category = {\"vp\": \"/just/vids\"}\n    elif ext in MUSIC.split():\n        by_category = {\"vp\": \"/just/tunes\"}\n    else:\n        by_category = {}  # no action\n\n    # now choose the default effect to apply; can be any of these:\n    # into_junk  into_subfolder  into_toplevel  into_sibling  by_category\n    effect = into_sibling\n\n    ##\n    ## but we can keep going, adding more speicifc rules\n    ## which can take precedence, replacing the fallback\n    ## effect we just specified:\n    ##\n\n    fn = fn.lower()  # lowercase filename to make this easier\n\n    if \"screenshot\" in fn:\n        effect = {\"vp\": \"/ss\"}\n    if \"mpv_\" in fn:\n        effect = {\"vp\": \"/anishots\"}\n    elif \"debian\" in fn or \"biebian\" in fn:\n        effect = {\"vp\": \"/linux-ISOs\"}\n    elif re.search(r\"ep(isode |\\.)?[0-9]\", fn):\n        effect = {\"vp\": \"/podcasts\"}\n\n    # regex lets you grab a part of the matching\n    # text and use that in the upload path:\n    m = re.search(r\"\\b(op|ed)([^a-z]|$)\", fn)\n    if m:\n        # the regex matched; use \"anime-op\" or \"anime-ed\"\n        effect = {\"vp\": \"/anime-\" + m[1]}\n\n    # aaand DO IT\n    print(json.dumps({\"reloc\": effect}))",
    "source": "github_repo:9001/copyparty",
    "file": "bin/hooks/reloc-by-ext.py",
    "license": "MIT",
    "language": "python"
}