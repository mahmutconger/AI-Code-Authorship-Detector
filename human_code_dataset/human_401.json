{
    "code": "def create_starlette_app(mcp_server: Server, *, debug: bool = False) -> Starlette:\n    sse = SseServerTransport(\"/messages/\")\n    session_manager = StreamableHTTPSessionManager(\n        app=mcp_server,\n        event_store=None,\n        json_response=True,\n        stateless=True,\n    )\n\n    async def handle_sse(request: Request) -> None:\n        async with sse.connect_sse(\n            request.scope,\n            request.receive,\n            request._send,\n        ) as (read_stream, write_stream):\n            await mcp_server.run(\n                read_stream,\n                write_stream,\n                mcp_server.create_initialization_options(),\n            )\n\n    async def handle_streamable_http(\n        scope: Scope, receive: Receive, send: Send\n    ) -> None:\n        await session_manager.handle_request(scope, receive, send)\n\n    @contextlib.asynccontextmanager\n    async def lifespan(app: Starlette) -> AsyncIterator[None]:\n        \"\"\"Context manager for session manager.\"\"\"\n        async with session_manager.run():\n            print(\"Application started with StreamableHTTP session manager!\")\n            try:\n                yield\n            finally:\n                print(\"Application shutting down...\")\n\n    return Starlette(\n        debug=debug,\n        routes=[\n            Route(\"/sse\", endpoint=handle_sse),\n            Mount(\"/mcp\", app=handle_streamable_http),\n            Mount(\"/messages/\", app=sse.handle_post_message),\n        ],\n        lifespan=lifespan,\n    )",
    "source": "github_repo:microsoft/markitdown",
    "file": "packages/markitdown-mcp/src/markitdown_mcp/__main__.py",
    "license": "MIT",
    "language": "python"
}