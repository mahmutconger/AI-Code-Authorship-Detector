{
    "code": "def record_intercept_requests(d: CliDirector):\n    tmux = d.start_session(width=120, height=36)\n    window = tmux.attached_window\n\n    d.start_recording(\"recordings/mitmproxy_intercept_requests.cast\")\n    d.message(\n        \"Welcome to the mitmproxy tutorial. In this lesson we cover the interception of requests.\"\n    )\n    d.pause(1)\n    d.exec(\"mitmproxy\")\n    d.pause(3)\n\n    d.message(\"We first need to configure mitmproxy to intercept requests.\")\n\n    d.message(\n        \"Press `i` to prepopulate mitmproxy’s command prompt with `set intercept ''`.\"\n    )\n    d.type(\"i\")\n    d.pause(2)\n\n    d.message(\n        \"We use the flow filter expression `~u <regex>` to only intercept specific URLs.\"\n    )\n    d.message(\n        \"Additionally, we use the filter `~q` to only intercept requests, but not responses.\"\n    )\n    d.message(\"We combine both flow filters using `&`.\")\n\n    d.message(\n        \"Enter `~u /Dunedin & ~q` between the quotes of the `set intercept` command and press `ENTER`.\"\n    )\n    d.exec(\"~u /Dunedin & ~q\")\n    d.message(\"The bottom bar shows that the interception has been configured.\")\n\n    d.message(\"Let’s generate a request using `curl` in a separate terminal.\")\n\n    pane_top = d.current_pane\n    pane_bottom = window.split_window(attach=True)\n    pane_bottom.resize_pane(height=12)\n\n    d.focus_pane(pane_bottom)\n    d.pause(2)\n\n    d.exec('curl --proxy http://127.0.0.1:8080 \"http://wttr.in/Dunedin?0\"')\n    d.pause(2)\n\n    d.focus_pane(pane_top)\n\n    d.message(\"You see a new line in in the list of flows.\")\n    d.message(\n        \"The new flow is displayed in red to indicate that it has been intercepted.\"\n    )\n    d.message(\n        \"Put the focus (`>>`) on the intercepted flow. This is already the case in our example.\"\n    )\n    d.message(\"Press `a` to resume this flow without making any changes.\")\n    d.type(\"a\")\n    d.pause(2)\n\n    d.focus_pane(pane_bottom)\n\n    d.message(\"Submit another request and focus its flow.\")\n    d.press_key(\"Up\")\n    d.press_key(\"Enter\")\n    d.pause(2)\n\n    d.focus_pane(pane_top)\n    d.press_key(\"Down\")\n    d.pause(1)\n\n    d.message(\n        \"Press `X` to kill this flow, i.e., discard it without forwarding it to its final destination `wttr.in`.\"\n    )\n    d.type(\"X\")\n    d.pause(3)\n\n    d.message(\"In the next lesson you will learn to modify intercepted flows.\")\n    d.save_instructions(\"recordings/mitmproxy_intercept_requests_instructions.json\")\n    d.end()",
    "source": "github_repo:mitmproxy/mitmproxy",
    "file": "docs/scripts/clirecording/screenplays.py",
    "license": "MIT",
    "language": "python"
}