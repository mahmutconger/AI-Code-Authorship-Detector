{
    "code": "def init(\n    project_name: str = typer.Argument(None, help=\"Name for your new project directory (optional if using --here, or use '.' for current directory)\"),\n    ai_assistant: str = typer.Option(None, \"--ai\", help=\"AI assistant to use: claude, gemini, copilot, cursor-agent, qwen, opencode, codex, windsurf, kilocode, auggie, codebuddy, amp, shai, or q\"),\n    script_type: str = typer.Option(None, \"--script\", help=\"Script type to use: sh or ps\"),\n    ignore_agent_tools: bool = typer.Option(False, \"--ignore-agent-tools\", help=\"Skip checks for AI agent tools like Claude Code\"),\n    no_git: bool = typer.Option(False, \"--no-git\", help=\"Skip git repository initialization\"),\n    here: bool = typer.Option(False, \"--here\", help=\"Initialize project in the current directory instead of creating a new one\"),\n    force: bool = typer.Option(False, \"--force\", help=\"Force merge/overwrite when using --here (skip confirmation)\"),\n    skip_tls: bool = typer.Option(False, \"--skip-tls\", help=\"Skip SSL/TLS verification (not recommended)\"),\n    debug: bool = typer.Option(False, \"--debug\", help=\"Show verbose diagnostic output for network and extraction failures\"),\n    github_token: str = typer.Option(None, \"--github-token\", help=\"GitHub token to use for API requests (or set GH_TOKEN or GITHUB_TOKEN environment variable)\"),\n):\n    \"\"\"\n    Initialize a new Specify project from the latest template.\n    \n    This command will:\n    1. Check that required tools are installed (git is optional)\n    2. Let you choose your AI assistant\n    3. Download the appropriate template from GitHub\n    4. Extract the template to a new project directory or current directory\n    5. Initialize a fresh git repository (if not --no-git and no existing repo)\n    6. Optionally set up AI assistant commands\n    \n    Examples:\n        specify init my-project\n        specify init my-project --ai claude\n        specify init my-project --ai copilot --no-git\n        specify init --ignore-agent-tools my-project\n        specify init . --ai claude         # Initialize in current directory\n        specify init .                     # Initialize in current directory (interactive AI selection)\n        specify init --here --ai claude    # Alternative syntax for current directory\n        specify init --here --ai codex\n        specify init --here --ai codebuddy\n        specify init --here\n        specify init --here --force  # Skip confirmation when current directory not empty\n    \"\"\"\n\n    show_banner()\n\n    if project_name == \".\":\n        here = True\n        project_name = None  # Clear project_name to use existing validation logic\n\n    if here and project_name:\n        console.print(\"[red]Error:[/red] Cannot specify both project name and --here flag\")\n        raise typer.Exit(1)\n\n    if not here and not project_name:\n        console.print(\"[red]Error:[/red] Must specify either a project name, use '.' for current directory, or use --here flag\")\n        raise typer.Exit(1)\n\n    if here:\n        project_name = Path.cwd().name\n        project_path = Path.cwd()\n\n        existing_items = list(project_path.iterdir())\n        if existing_items:\n            console.print(f\"[yellow]Warning:[/yellow] Current directory is not empty ({len(existing_items)} items)\")\n            console.print(\"[yellow]Template files will be merged with existing content and may overwrite existing files[/yellow]\")\n            if force:\n                console.print(\"[cyan]--force supplied: skipping confirmation and proceeding with merge[/cyan]\")\n            else:\n                response = typer.confirm(\"Do you want to continue?\")\n                if not response:\n                    console.print(\"[yellow]Operation cancelled[/yellow]\")\n                    raise typer.Exit(0)\n    else:\n        project_path = Path(project_name).resolve()\n        if project_path.exists():\n            error_panel = Panel(\n                f\"Directory '[cyan]{project_name}[/cyan]' already exists\\n\"\n                \"Please choose a different project name or remove the existing directory.\",\n                title=\"[red]Directory Conflict[/red]\",\n                border_style=\"red\",\n                padding=(1, 2)\n            )\n            console.print()\n            console.print(error_panel)\n            raise typer.Exit(1)\n\n    current_dir = Path.cwd()\n\n    setup_lines = [\n        \"[cyan]Specify Project Setup[/cyan]\",\n        \"\",\n        f\"{'Project':<15} [green]{project_path.name}[/green]\",\n        f\"{'Working Path':<15} [dim]{current_dir}[/dim]\",\n    ]\n\n    if not here:\n        setup_lines.append(f\"{'Target Path':<15} [dim]{project_path}[/dim]\")\n\n    console.print(Panel(\"\\n\".join(setup_lines), border_style=\"cyan\", padding=(1, 2)))\n\n    should_init_git = False\n    if not no_git:\n        should_init_git = check_tool(\"git\")\n        if not should_init_git:\n            console.print(\"[yellow]Git not found - will skip repository initialization[/yellow]\")\n\n    if ai_assistant:\n        if ai_assistant not in AGENT_CONFIG:\n            console.print(f\"[red]Error:[/red] Invalid AI assistant '{ai_assistant}'. Choose from: {', '.join(AGENT_CONFIG.keys())}\")\n            raise typer.Exit(1)\n        selected_ai = ai_assistant\n    else:\n        # Create options dict for selection (agent_key: display_name)\n        ai_choices = {key: config[\"name\"] for key, config in AGENT_CONFIG.items()}\n        selected_ai = select_with_arrows(\n            ai_choices, \n            \"Choose your AI assistant:\", \n            \"copilot\"\n        )\n\n    if not ignore_agent_tools:\n        agent_config = AGENT_CONFIG.get(selected_ai)\n        if agent_config and agent_config[\"requires_cli\"]:\n            install_url = agent_config[\"install_url\"]\n            if not check_tool(selected_ai):\n                error_panel = Panel(\n                    f\"[cyan]{selected_ai}[/cyan] not found\\n\"\n                    f\"Install from: [cyan]{install_url}[/cyan]\\n\"\n                    f\"{agent_config['name']} is required to continue with this project type.\\n\\n\"\n                    \"Tip: Use [cyan]--ignore-agent-tools[/cyan] to skip this check\",\n                    title=\"[red]Agent Detection Error[/red]\",\n                    border_style=\"red\",\n                    padding=(1, 2)\n                )\n                console.print()\n                console.print(error_panel)\n                raise typer.Exit(1)\n\n    if script_type:\n        if script_type not in SCRIPT_TYPE_CHOICES:\n            console.print(f\"[red]Error:[/red] Invalid script type '{script_type}'. Choose from: {', '.join(SCRIPT_TYPE_CHOICES.keys())}\")\n            raise typer.Exit(1)\n        selected_script = script_type\n    else:\n        default_script = \"ps\" if os.name == \"nt\" else \"sh\"\n\n        if sys.stdin.isatty():\n            selected_script = select_with_arrows(SCRIPT_TYPE_CHOICES, \"Choose script type (or press Enter)\", default_script)\n        else:\n            selected_script = default_script\n\n    console.print(f\"[cyan]Selected AI assistant:[/cyan] {selected_ai}\")\n    console.print(f\"[cyan]Selected script type:[/cyan] {selected_script}\")\n\n    tracker = StepTracker(\"Initialize Specify Project\")\n\n    sys._specify_tracker_active = True\n\n    tracker.add(\"precheck\", \"Check required tools\")\n    tracker.complete(\"precheck\", \"ok\")\n    tracker.add(\"ai-select\", \"Select AI assistant\")\n    tracker.complete(\"ai-select\", f\"{selected_ai}\")\n    tracker.add(\"script-select\", \"Select script type\")\n    tracker.complete(\"script-select\", selected_script)\n    for key, label in [\n        (\"fetch\", \"Fetch latest release\"),\n        (\"download\", \"Download template\"),\n        (\"extract\", \"Extract template\"),\n        (\"zip-list\", \"Archive contents\"),\n        (\"extracted-summary\", \"Extraction summary\"),\n        (\"chmod\", \"Ensure scripts executable\"),\n        (\"cleanup\", \"Cleanup\"),\n        (\"git\", \"Initialize git repository\"),\n        (\"final\", \"Finalize\")\n    ]:\n        tracker.add(key, label)\n\n    # Track git error message outside Live context so it persists\n    git_error_message = None\n\n    with Live(tracker.render(), console=console, refresh_per_second=8, transient=True) as live:\n        tracker.attach_refresh(lambda: live.update(tracker.render()))\n        try:\n            verify = not skip_tls\n            local_ssl_context = ssl_context if verify else False\n            local_client = httpx.Client(verify=local_ssl_context)\n\n            download_and_extract_template(project_path, selected_ai, selected_script, here, verbose=False, tracker=tracker, client=local_client, debug=debug, github_token=github_token)\n\n            ensure_executable_scripts(project_path, tracker=tracker)\n\n            if not no_git:\n                tracker.start(\"git\")\n                if is_git_repo(project_path):\n                    tracker.complete(\"git\", \"existing repo detected\")\n                elif should_init_git:\n                    success, error_msg = init_git_repo(project_path, quiet=True)\n                    if success:\n                        tracker.complete(\"git\", \"initialized\")\n                    else:\n                        tracker.error(\"git\", \"init failed\")\n                        git_error_message = error_msg\n                else:\n                    tracker.skip(\"git\", \"git not available\")\n            else:\n                tracker.skip(\"git\", \"--no-git flag\")\n\n            tracker.complete(\"final\", \"project ready\")\n        except Exception as e:\n            tracker.error(\"final\", str(e))\n            console.print(Panel(f\"Initialization failed: {e}\", title=\"Failure\", border_style=\"red\"))\n            if debug:\n                _env_pairs = [\n                    (\"Python\", sys.version.split()[0]),\n                    (\"Platform\", sys.platform),\n                    (\"CWD\", str(Path.cwd())),\n                ]\n                _label_width = max(len(k) for k, _ in _env_pairs)\n                env_lines = [f\"{k.ljust(_label_width)} → [bright_black]{v}[/bright_black]\" for k, v in _env_pairs]\n                console.print(Panel(\"\\n\".join(env_lines), title=\"Debug Environment\", border_style=\"magenta\"))\n            if not here and project_path.exists():\n                shutil.rmtree(project_path)\n            raise typer.Exit(1)\n        finally:\n            pass\n\n    console.print(tracker.render())\n    console.print(\"\\n[bold green]Project ready.[/bold green]\")\n    \n    # Show git error details if initialization failed\n    if git_error_message:\n        console.print()\n        git_error_panel = Panel(\n            f\"[yellow]Warning:[/yellow] Git repository initialization failed\\n\\n\"\n            f\"{git_error_message}\\n\\n\"\n            f\"[dim]You can initialize git manually later with:[/dim]\\n\"\n            f\"[cyan]cd {project_path if not here else '.'}[/cyan]\\n\"\n            f\"[cyan]git init[/cyan]\\n\"\n            f\"[cyan]git add .[/cyan]\\n\"\n            f\"[cyan]git commit -m \\\"Initial commit\\\"[/cyan]\",\n            title=\"[red]Git Initialization Failed[/red]\",\n            border_style=\"red\",\n            padding=(1, 2)\n        )\n        console.print(git_error_panel)\n\n    # Agent folder security notice\n    agent_config = AGENT_CONFIG.get(selected_ai)\n    if agent_config:\n        agent_folder = agent_config[\"folder\"]\n        security_notice = Panel(\n            f\"Some agents may store credentials, auth tokens, or other identifying and private artifacts in the agent folder within your project.\\n\"\n            f\"Consider adding [cyan]{agent_folder}[/cyan] (or parts of it) to [cyan].gitignore[/cyan] to prevent accidental credential leakage.\",\n            title=\"[yellow]Agent Folder Security[/yellow]\",\n            border_style=\"yellow\",\n            padding=(1, 2)\n        )\n        console.print()\n        console.print(security_notice)\n\n    steps_lines = []\n    if not here:\n        steps_lines.append(f\"1. Go to the project folder: [cyan]cd {project_name}[/cyan]\")\n        step_num = 2\n    else:\n        steps_lines.append(\"1. You're already in the project directory!\")\n        step_num = 2\n\n    # Add Codex-specific setup step if needed\n    if selected_ai == \"codex\":\n        codex_path = project_path / \".codex\"\n        quoted_path = shlex.quote(str(codex_path))\n        if os.name == \"nt\":  # Windows\n            cmd = f\"setx CODEX_HOME {quoted_path}\"\n        else:  # Unix-like systems\n            cmd = f\"export CODEX_HOME={quoted_path}\"\n        \n        steps_lines.append(f\"{step_num}. Set [cyan]CODEX_HOME[/cyan] environment variable before running Codex: [cyan]{cmd}[/cyan]\")\n        step_num += 1\n\n    steps_lines.append(f\"{step_num}. Start using slash commands with your AI agent:\")\n\n    steps_lines.append(\"   2.1 [cyan]/speckit.constitution[/] - Establish project principles\")\n    steps_lines.append(\"   2.2 [cyan]/speckit.specify[/] - Create baseline specification\")\n    steps_lines.append(\"   2.3 [cyan]/speckit.plan[/] - Create implementation plan\")\n    steps_lines.append(\"   2.4 [cyan]/speckit.tasks[/] - Generate actionable tasks\")\n    steps_lines.append(\"   2.5 [cyan]/speckit.implement[/] - Execute implementation\")\n\n    steps_panel = Panel(\"\\n\".join(steps_lines), title=\"Next Steps\", border_style=\"cyan\", padding=(1,2))\n    console.print()\n    console.print(steps_panel)\n\n    enhancement_lines = [\n        \"Optional commands that you can use for your specs [bright_black](improve quality & confidence)[/bright_black]\",\n        \"\",\n        f\"○ [cyan]/speckit.clarify[/] [bright_black](optional)[/bright_black] - Ask structured questions to de-risk ambiguous areas before planning (run before [cyan]/speckit.plan[/] if used)\",\n        f\"○ [cyan]/speckit.analyze[/] [bright_black](optional)[/bright_black] - Cross-artifact consistency & alignment report (after [cyan]/speckit.tasks[/], before [cyan]/speckit.implement[/])\",\n        f\"○ [cyan]/speckit.checklist[/] [bright_black](optional)[/bright_black] - Generate quality checklists to validate requirements completeness, clarity, and consistency (after [cyan]/speckit.plan[/])\"\n    ]\n    enhancements_panel = Panel(\"\\n\".join(enhancement_lines), title=\"Enhancement Commands\", border_style=\"cyan\", padding=(1,2))\n    console.print()\n    console.print(enhancements_panel)",
    "source": "github_repo:github/spec-kit",
    "file": "src/specify_cli/__init__.py",
    "license": "MIT",
    "language": "python"
}