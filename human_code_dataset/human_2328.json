{
    "code": "def loader_config(self):\n        # Results for dataset: df: pd.DataFrame\n        #   len(df.columns) == 6 + 6 * 16, len(df.index.get_level_values(level=\"datetime\").unique()) == T\n        #   df.columns: close0, close1, ..., close16, open0, ..., open16, ..., vwap16\n        #       freq == day:\n        #           close0, open0, low0, high0, volume0, vwap0\n        #       freq == 1min:\n        #           close1, ..., close16, ..., vwap1, ..., vwap16\n        #   df.index.name == [\"datetime\", \"instrument\"]: pd.MultiIndex\n        # Example:\n        #                          feature                        ...                  label\n        #                           close0      open0       low0  ... vwap1 vwap16    LABEL0\n        # datetime   instrument                                   ...\n        # 2020-10-09 SH600000    11.794546  11.819587  11.769505  ...   NaN    NaN -0.005214\n        # 2020-10-15 SH600000    12.044961  11.944795  11.932274  ...   NaN    NaN -0.007202\n        # ...                          ...        ...        ...  ...   ...    ...       ...\n        # 2021-05-28 SZ300676     6.369684   6.495406   6.306568  ...   NaN    NaN -0.001321\n        # 2021-05-31 SZ300676     6.601626   6.465643   6.465130  ...   NaN    NaN -0.023428\n\n        # features day: len(columns) == 6, freq = day\n        # $close is the closing price of the current trading day:\n        #   if the user needs to get the `close` before the last T days, use Ref($close, T-1), for example:\n        #                                    $close  Ref($close, 1)  Ref($close, 2)  Ref($close, 3)  Ref($close, 4)\n        #         instrument datetime\n        #         SH600519   2021-06-01  244.271530\n        #                    2021-06-02  242.205917      244.271530\n        #                    2021-06-03  242.229889      242.205917      244.271530\n        #                    2021-06-04  245.421524      242.229889      242.205917      244.271530\n        #                    2021-06-07  247.547089      245.421524      242.229889      242.205917      244.271530\n\n        # WARNING: Ref($close, N), if N == 0, Ref($close, N) ==> $close\n\n        fields = [\"$close\", \"$open\", \"$low\", \"$high\", \"$volume\", \"$vwap\"]\n        # names: close0, open0, ..., vwap0\n        names = list(map(lambda x: x.strip(\"$\") + \"0\", fields))\n\n        config = {\"feature_day\": (fields, names)}\n\n        # features 15min: len(columns) == 6 * 16, freq = 1min\n        #   $close is the closing price of the current trading day:\n        #       if the user gets 'close' for the i-th 15min of the last T days, use `Ref(Mean($close, 15), (T-1) * 240 + i * 15)`, for example:\n        #                                    Ref(Mean($close, 15), 225)  Ref(Mean($close, 15), 465)  Ref(Mean($close, 15), 705)\n        #             instrument datetime\n        #             SH600519   2021-05-31                  241.769897                  243.077942                  244.712997\n        #                        2021-06-01                  244.271530                  241.769897                  243.077942\n        #                        2021-06-02                  242.205917                  244.271530                  241.769897\n\n        # WARNING: Ref(Mean($close, 15), N), if N == 0, Ref(Mean($close, 15), N) ==> Mean($close, 15)\n\n        # Results of the current script:\n        #   time:   09:00 --> 09:14,            ..., 14:45 --> 14:59\n        #   fields: Ref(Mean($close, 15), 225), ..., Mean($close, 15)\n        #   name:   close1,                     ..., close16\n        #\n\n        # Expression description: take close as an example\n        #   Mean($close, 15) ==> df[\"$close\"].rolling(15, min_periods=1).mean()\n        #   Ref(Mean($close, 15), 15) ==> df[\"$close\"].rolling(15, min_periods=1).mean().shift(15)\n\n        #   NOTE: The last data of each trading day, which is the average of the i-th 15 minutes\n\n        # Average:\n        #   Average of the i-th 15-minute period of each trading day: 1 <= i <= 250 // 16\n        #       Avg(15minutes): Ref(Mean($close, 15), 240 - i * 15)\n        #\n        #   Average of the first 15 minutes of each trading day; i = 1\n        #       Avg(09:00 --> 09:14), df.index.loc[\"09:14\"]: Ref(Mean($close, 15), 240- 1 * 15) ==> Ref(Mean($close, 15), 225)\n        #   Average of the last 15 minutes of each trading day; i = 16\n        #       Avg(14:45 --> 14:59), df.index.loc[\"14:59\"]: Ref(Mean($close, 15), 240 - 16 * 15) ==> Ref(Mean($close, 15), 0) ==> Mean($close, 15)\n\n        # 15min resample to day\n        #   df.resample(\"1d\").last()\n        tmp_fields = []\n        tmp_names = []\n        for i, _f in enumerate(fields):\n            _fields = [f\"Ref(Mean({_f}, 15), {j * 15})\" for j in range(1, 240 // 15)]\n            _names = [f\"{names[i][:-1]}{int(names[i][-1])+j}\" for j in range(240 // 15 - 1, 0, -1)]\n            _fields.append(f\"Mean({_f}, 15)\")\n            _names.append(f\"{names[i][:-1]}{int(names[i][-1])+240 // 15}\")\n            tmp_fields += _fields\n            tmp_names += _names\n        config[\"feature_15min\"] = (tmp_fields, tmp_names)\n        # label\n        config[\"label\"] = ([\"Ref($close, -2)/Ref($close, -1) - 1\"], [\"LABEL0\"])\n        return config",
    "source": "github_repo:microsoft/qlib",
    "file": "examples/benchmarks/LightGBM/multi_freq_handler.py",
    "license": "MIT",
    "language": "python"
}