{
    "code": "class GoLogin:\n    def __init__(self, session, is_auto_code, auto_code_type):\n        self.session = session\n        self.randCode = \"\"\n        self.is_auto_code = is_auto_code\n        self.auto_code_type = auto_code_type\n\n    def auth(self):\n        \"\"\"\n        :return:\n        \"\"\"\n        self.session.httpClint.send(self.session.urls[\"loginInitCdn1\"])\n        uamtkStaticUrl = self.session.urls[\"uamtk-static\"]\n        uamtkStaticData = {\"appid\": \"otn\"}\n        return self.session.httpClint.send(uamtkStaticUrl, uamtkStaticData)\n\n    def codeCheck(self):\n        \"\"\"\n        验证码校验\n        :return:\n        \"\"\"\n        codeCheckUrl = copy.deepcopy(self.session.urls[\"codeCheck1\"])\n        codeCheckUrl[\"req_url\"] = codeCheckUrl[\"req_url\"].format(self.randCode, int(time.time() * 1000))\n        fresult = self.session.httpClint.send(codeCheckUrl)\n        if not isinstance(fresult, str):\n            print(\"登录失败\")\n            return\n        fresult = eval(fresult.split(\"(\")[1].split(\")\")[0])\n        if \"result_code\" in fresult and fresult[\"result_code\"] == \"4\":\n            print(u\"验证码通过,开始登录..\")\n            return True\n        else:\n            if \"result_message\" in fresult:\n                print(fresult[\"result_message\"])\n            sleep(1)\n            self.session.httpClint.del_cookies()\n\n    def baseLogin(self, user, passwd):\n        \"\"\"\n        登录过程\n        :param user:\n        :param passwd:\n        :return: 权限校验码\n        \"\"\"\n        logurl = self.session.urls[\"login\"]\n\n        loginData = OrderedDict()\n        loginData[\"username\"] = user,\n        loginData[\"password\"] = passwd,\n        loginData[\"appid\"] = \"otn\",\n        loginData[\"answer\"] = self.randCode,\n\n        tresult = self.session.httpClint.send(logurl, loginData)\n        if 'result_code' in tresult and tresult[\"result_code\"] == 0:\n            print(u\"登录成功\")\n            tk = self.auth()\n            if \"newapptk\" in tk and tk[\"newapptk\"]:\n                return tk[\"newapptk\"]\n            else:\n                return False\n        elif 'result_message' in tresult and tresult['result_message']:\n            messages = tresult['result_message']\n            if messages.find(u\"密码输入错误\") is not -1:\n                raise UserPasswordException(\"{0}\".format(messages))\n            else:\n                print(u\"登录失败: {0}\".format(messages))\n                print(u\"尝试重新登陆\")\n                return False\n        else:\n            return False\n\n    def getUserName(self, uamtk):\n        \"\"\"\n        登录成功后,显示用户名\n        :return:\n        \"\"\"\n        if not uamtk:\n            return u\"权限校验码不能为空\"\n        else:\n            uamauthclientUrl = self.session.urls[\"uamauthclient\"]\n            data = {\"tk\": uamtk}\n            uamauthclientResult = self.session.httpClint.send(uamauthclientUrl, data)\n            if uamauthclientResult:\n                if \"result_code\" in uamauthclientResult and uamauthclientResult[\"result_code\"] == 0:\n                    print(u\"欢迎 {} 登录\".format(uamauthclientResult[\"username\"]))\n                    return True\n                else:\n                    return False\n            else:\n                self.session.httpClint.send(uamauthclientUrl, data)\n                url = self.session.urls[\"getUserInfo\"]\n                self.session.httpClint.send(url)\n\n    def go_login(self):\n        \"\"\"\n        登陆\n        :param user: 账户名\n        :param passwd: 密码\n        :return:\n        \"\"\"\n        user, passwd = TickerConfig.USER, TickerConfig.PWD\n        if not user or not passwd:\n            raise UserPasswordException(u\"温馨提示: 用户名或者密码为空，请仔细检查\")\n        login_num = 0\n        while True:\n            if loginConf(self.session):\n\n                result = getPassCodeNewOrderAndLogin1(session=self.session, imgType=\"login\")\n                if not result:\n                    continue\n                self.randCode = getRandCode(self.is_auto_code, self.auto_code_type, result)\n                print(self.randCode)\n                login_num += 1\n                self.auth()\n                if self.codeCheck():\n                    uamtk = self.baseLogin(user, passwd)\n                    if uamtk:\n                        self.getUserName(uamtk)\n                        break\n            else:\n                loginAysnSuggest(self.session, username=user, password=passwd)\n                login_num += 1\n                break",
    "source": "github_repo:testerSunshine/12306",
    "file": "init/login.py",
    "license": "MIT",
    "language": "python"
}