{
    "code": "# -*- coding: utf-8 -*-\n\nimport ccxt.pro\nfrom asyncio import gather, run\n\n\nasync def symbol_loop(exchange, method, symbol):\n    print('Starting', exchange.id, method, symbol)\n    while True:\n        try:\n            response = await getattr(exchange, method)(symbol)\n            now = exchange.milliseconds()\n            iso8601 = exchange.iso8601(now)\n            if method == 'watchOrderBook':\n                print(iso8601, exchange.id, method, symbol, response['asks'][0], response['bids'][0])\n            elif method == 'watchTicker':\n                print(iso8601, exchange.id, method, symbol, response['high'], response['low'], response['bid'], response['ask'])\n            elif method == 'watchTrades':\n                print(iso8601, exchange.id, method, symbol, len(response), 'trades')\n\n        except Exception as e:\n            print(str(e))\n            # raise e  # uncomment to break all loops in case of an error in any one of them\n            break  # you can break just this one loop if it fails\n\n\nasync def method_loop(exchange, method, symbols):\n    print('Starting', exchange.id, method, symbols)\n    loops = [symbol_loop(exchange, method, symbol) for symbol in symbols]\n    await gather(*loops)\n\n\nasync def exchange_loop(exchange_id, methods):\n    print('Starting', exchange_id, methods)\n    exchange = getattr(ccxt.pro, exchange_id)()\n    loops = [method_loop(exchange, method, symbols) for method, symbols in methods.items()]\n    await gather(*loops)\n    await exchange.close()\n\n\nasync def main():\n    exchanges = {\n        'okex': {\n            'watchOrderBook': ['BTC/USDT', 'ETH/BTC', 'ETH/USDT'],\n            'watchTicker': ['BTC/USDT'],\n        },\n        'binance': {\n            'watchOrderBook': ['BTC/USDT', 'ETH/BTC'],\n            'watchTrades': [ 'ETH/BTC' ],\n        },\n    }\n    loops = [exchange_loop(exchange_id, methods) for exchange_id, methods in exchanges.items()]\n    await gather(*loops)\n\n\nrun(main())",
    "source": "github_repo:ccxt/ccxt",
    "file": "examples/ccxt.pro/py/many-exchanges-many-different-streams.py",
    "license": "MIT",
    "language": "python"
}