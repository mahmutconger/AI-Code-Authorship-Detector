{
    "code": "class EnterpriseActionKitToolAdapter:\n    \"\"\"Adapter that creates BaseTool instances for enterprise actions.\"\"\"\n\n    def __init__(\n        self,\n        enterprise_action_token: str,\n        enterprise_api_base_url: str | None = None,\n    ):\n        \"\"\"Initialize the adapter with an enterprise action token.\"\"\"\n        self._set_enterprise_action_token(enterprise_action_token)\n        self._actions_schema = {}  # type: ignore[var-annotated]\n        self._tools = None\n        self.enterprise_api_base_url = (\n            enterprise_api_base_url or get_enterprise_api_base_url()\n        )\n\n    def tools(self) -> list[BaseTool]:\n        \"\"\"Get the list of tools created from enterprise actions.\"\"\"\n        if self._tools is None:\n            self._fetch_actions()\n            self._create_tools()\n        return self._tools or []\n\n    def _fetch_actions(self):\n        \"\"\"Fetch available actions from the API.\"\"\"\n        try:\n            actions_url = f\"{self.enterprise_api_base_url}/actions\"\n            headers = {\"Authorization\": f\"Bearer {self.enterprise_action_token}\"}\n\n            response = requests.get(actions_url, headers=headers, timeout=30)\n            response.raise_for_status()\n\n            raw_data = response.json()\n            if \"actions\" not in raw_data:\n                return\n\n            parsed_schema = {}\n            action_categories = raw_data[\"actions\"]\n\n            for action_list in action_categories.values():\n                if isinstance(action_list, list):\n                    for action in action_list:\n                        action_name = action.get(\"name\")\n                        if action_name:\n                            action_schema = {\n                                \"function\": {\n                                    \"name\": action_name,\n                                    \"description\": action.get(\n                                        \"description\", f\"Execute {action_name}\"\n                                    ),\n                                    \"parameters\": action.get(\"parameters\", {}),\n                                }\n                            }\n                            parsed_schema[action_name] = action_schema\n\n            self._actions_schema = parsed_schema\n\n        except Exception:\n            import traceback\n\n            traceback.print_exc()\n\n    def _generate_detailed_description(\n        self, schema: dict[str, Any], indent: int = 0\n    ) -> list[str]:\n        \"\"\"Generate detailed description for nested schema structures.\"\"\"\n        descriptions = []\n        indent_str = \"  \" * indent\n\n        schema_type = schema.get(\"type\", \"string\")\n\n        if schema_type == \"object\":\n            properties = schema.get(\"properties\", {})\n            required_fields = schema.get(\"required\", [])\n\n            if properties:\n                descriptions.append(f\"{indent_str}Object with properties:\")\n                for prop_name, prop_schema in properties.items():\n                    prop_desc = prop_schema.get(\"description\", \"\")\n                    is_required = prop_name in required_fields\n                    req_str = \" (required)\" if is_required else \" (optional)\"\n                    descriptions.append(\n                        f\"{indent_str}  - {prop_name}: {prop_desc}{req_str}\"\n                    )\n\n                    if prop_schema.get(\"type\") == \"object\":\n                        descriptions.extend(\n                            self._generate_detailed_description(prop_schema, indent + 2)\n                        )\n                    elif prop_schema.get(\"type\") == \"array\":\n                        items_schema = prop_schema.get(\"items\", {})\n                        if items_schema.get(\"type\") == \"object\":\n                            descriptions.append(f\"{indent_str}    Array of objects:\")\n                            descriptions.extend(\n                                self._generate_detailed_description(\n                                    items_schema, indent + 3\n                                )\n                            )\n                        elif \"enum\" in items_schema:\n                            descriptions.append(\n                                f\"{indent_str}    Array of enum values: {items_schema['enum']}\"\n                            )\n                    elif \"enum\" in prop_schema:\n                        descriptions.append(\n                            f\"{indent_str}    Enum values: {prop_schema['enum']}\"\n                        )\n\n        return descriptions\n\n    def _create_tools(self):\n        \"\"\"Create BaseTool instances for each action.\"\"\"\n        tools = []\n\n        for action_name, action_schema in self._actions_schema.items():\n            function_details = action_schema.get(\"function\", {})\n            description = function_details.get(\"description\", f\"Execute {action_name}\")\n\n            parameters = function_details.get(\"parameters\", {})\n            param_descriptions = []\n\n            if parameters.get(\"properties\"):\n                param_descriptions.append(\"\\nDetailed Parameter Structure:\")\n                param_descriptions.extend(\n                    self._generate_detailed_description(parameters)\n                )\n\n            full_description = description + \"\\n\".join(param_descriptions)\n\n            tool = EnterpriseActionTool(\n                name=action_name.lower().replace(\" \", \"_\"),\n                description=full_description,\n                action_name=action_name,\n                action_schema=action_schema,\n                enterprise_action_token=self.enterprise_action_token,\n                enterprise_api_base_url=self.enterprise_api_base_url,\n            )\n\n            tools.append(tool)\n\n        self._tools = tools\n\n    def _set_enterprise_action_token(self, enterprise_action_token: str | None):\n        if enterprise_action_token and not enterprise_action_token.startswith(\"PK_\"):\n            warnings.warn(\n                \"Legacy token detected, please consider using the new Enterprise Action Auth token. Check out our docs for more information https://docs.crewai.com/en/enterprise/features/integrations.\",\n                DeprecationWarning,\n                stacklevel=2,\n            )\n\n        token = enterprise_action_token or os.environ.get(\n            \"CREWAI_ENTERPRISE_TOOLS_TOKEN\"\n        )\n\n        self.enterprise_action_token = token\n\n    def __enter__(self):\n        return self.tools()\n\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        pass",
    "source": "github_repo:crewAIInc/crewAI",
    "file": "lib/crewai-tools/src/crewai_tools/adapters/enterprise_adapter.py",
    "license": "MIT",
    "language": "python"
}