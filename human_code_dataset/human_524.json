{
    "code": "class CreateAgentStepEvent(BaseEvent):\n\t# Model fields\n\tid: str = Field(default_factory=uuid7str)\n\tuser_id: str = Field(max_length=255)  # Added for authorization checks\n\tdevice_id: str | None = Field(None, max_length=255)  # Device ID for auth lookup\n\tcreated_at: datetime = Field(default_factory=lambda: datetime.now(timezone.utc))\n\tagent_task_id: str\n\tstep: int\n\tevaluation_previous_goal: str = Field(max_length=MAX_STRING_LENGTH)\n\tmemory: str = Field(max_length=MAX_STRING_LENGTH)\n\tnext_goal: str = Field(max_length=MAX_STRING_LENGTH)\n\tactions: list[dict]\n\tscreenshot_url: str | None = Field(None, max_length=MAX_FILE_CONTENT_SIZE)  # ~50MB for base64 images\n\turl: str = Field(default='', max_length=MAX_URL_LENGTH)\n\n\t@field_validator('screenshot_url')\n\t@classmethod\n\tdef validate_screenshot_size(cls, v: str | None) -> str | None:\n\t\t\"\"\"Validate screenshot URL or base64 content size.\"\"\"\n\t\tif v is None or not v.startswith('data:'):\n\t\t\treturn v\n\t\t# It's base64 data, check size\n\t\tif ',' in v:\n\t\t\tbase64_part = v.split(',')[1]\n\t\t\testimated_size = len(base64_part) * 3 / 4\n\t\t\tif estimated_size > MAX_FILE_CONTENT_SIZE:\n\t\t\t\traise ValueError(f'Screenshot content exceeds maximum size of {MAX_FILE_CONTENT_SIZE / 1024 / 1024}MB')\n\t\treturn v\n\n\t@classmethod\n\tdef from_agent_step(\n\t\tcls, agent, model_output, result: list, actions_data: list[dict], browser_state_summary\n\t) -> 'CreateAgentStepEvent':\n\t\t\"\"\"Create a CreateAgentStepEvent from agent step data\"\"\"\n\t\t# Get first action details if available\n\t\tfirst_action = model_output.action[0] if model_output.action else None\n\n\t\t# Extract current state from model output\n\t\tcurrent_state = model_output.current_state if hasattr(model_output, 'current_state') else None\n\n\t\t# Capture screenshot as base64 data URL if available\n\t\tscreenshot_url = None\n\t\tif browser_state_summary.screenshot:\n\t\t\tscreenshot_url = f'data:image/png;base64,{browser_state_summary.screenshot}'\n\t\t\timport logging\n\n\t\t\tlogger = logging.getLogger(__name__)\n\t\t\tlogger.debug(f'ðŸ“¸ Including screenshot in CreateAgentStepEvent, length: {len(browser_state_summary.screenshot)}')\n\t\telse:\n\t\t\timport logging\n\n\t\t\tlogger = logging.getLogger(__name__)\n\t\t\tlogger.debug('ðŸ“¸ No screenshot in browser_state_summary for CreateAgentStepEvent')\n\n\t\treturn cls(\n\t\t\tuser_id='',  # To be filled by cloud handler\n\t\t\tdevice_id=agent.cloud_sync.auth_client.device_id\n\t\t\tif hasattr(agent, 'cloud_sync') and agent.cloud_sync and agent.cloud_sync.auth_client\n\t\t\telse None,\n\t\t\tagent_task_id=str(agent.task_id),\n\t\t\tstep=agent.state.n_steps,\n\t\t\tevaluation_previous_goal=current_state.evaluation_previous_goal if current_state else '',\n\t\t\tmemory=current_state.memory if current_state else '',\n\t\t\tnext_goal=current_state.next_goal if current_state else '',\n\t\t\tactions=actions_data,  # List of action dicts\n\t\t\turl=browser_state_summary.url,\n\t\t\tscreenshot_url=screenshot_url,\n\t\t)",
    "source": "github_repo:browser-use/browser-use",
    "file": "browser_use/agent/cloud_events.py",
    "license": "MIT",
    "language": "python"
}