{
    "code": "#!/usr/bin/env python\n\nfrom __future__ import print_function\n\nfrom datetime import datetime\nimport os\nfrom os import path\nimport re\nimport shutil\nimport subprocess\nfrom subprocess import Popen\nimport sys\n\nSHARE_DIR = path.join(path.dirname(__file__), \"../share/\")\n\n\ndef run(args):\n    return Popen(args, stdout=sys.stdout, stderr=sys.stderr).wait()\n\n\nstatus = subprocess.check_output([\"git\", \"status\", \"--porcelain\"])\nif len(status) > 0:\n    print(\"Unclean working tree. Commit or stash changes first.\", file=sys.stderr)\n    sys.exit(1)\n\ntimestamp = datetime.utcnow().strftime(\"%Y-%m-%d %H:%M:%S +0000\")\n\ncht_curr = path.join(SHARE_DIR, \"cht.sh.txt\")\ncht_new = path.join(SHARE_DIR, \"cht.sh.txt.new\")\n\nre_version = re.compile(r\"^__CHTSH_VERSION=(.*)$\")\nre_timestamp = re.compile(r\"^__CHTSH_DATETIME=.*$\")\n\nwith open(cht_curr, \"rt\") as fin:\n    with open(cht_new, \"wt\") as fout:\n        for line in fin:\n            match = re_version.match(line)\n            if match:\n                version = int(match.group(1)) + 1\n                fout.write(\"__CHTSH_VERSION=%s\\n\" % version)\n                continue\n\n            match = re_timestamp.match(line)\n            if match:\n                fout.write('__CHTSH_DATETIME=\"%s\"\\n' % timestamp)\n                continue\n\n            fout.write(line)\n\nshutil.copymode(cht_curr, cht_new)\nos.remove(cht_curr)\nos.rename(cht_new, cht_curr)\n\nmessage = \"cht: v%s\" % version\nrun([\"git\", \"add\", cht_curr])\nrun([\"git\", \"commit\", \"-m\", message])\nrun([\"git\", \"tag\", \"cht@%s\" % version, \"-m\", message])",
    "source": "github_repo:chubin/cheat.sh",
    "file": "bin/release.py",
    "license": "MIT",
    "language": "python"
}