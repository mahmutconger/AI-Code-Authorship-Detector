{
    "code": "# -*- coding: utf-8 -*-\n\nimport asyncio\nimport os\nfrom random import randint\nimport sys\nfrom pprint import pprint\nimport time\n\nroot = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))\nsys.path.append(root + '/python')\n\nimport ccxt.async_support as ccxt  # noqa: E402\n\nprint('CCXT Version:', ccxt.__version__)\n\n####################################################################################\n# Simple lending bot that will look for lending opportunities on bitfinex markets ##\n# and execute them using market orders.                                           ##\n#                                                                                 ##                 \n# Disclaimer: this bot is for educational purposes only. Use at your own risk.    ##\n####################################################################################\n\n# bot options\nwait_time = 5 # seconds to wait between each check\npaper_trading = True # set to false to actually execute trades\n\n# exchange you want to use to look for lending opportunities\nexchange = ccxt.bitfinex2()\n\n# currencies you want to lend\ncurrencies = [\n    \"fUST\",\n]\n\n# order sizes for each currency, adjust it to your liking\norder_sizes = {\n    \"fUST\": 100,\n}\n\nasync def get_last_funding_infos():\n    tasks = [ exchange.public_get_funding_stats_symbol_hist({ 'symbol': currency, 'limit': 1 }) for currency in currencies ]\n    results = await asyncio.gather(*tasks)\n    fundingInfos = {}\n    # parse results\n    for i in range(0, len(currencies)):\n        currency = currencies[i]\n        data = results[i][0]\n        fundingInfos[currency] = {\n            'rate': exchange.safe_number(data, 3),\n            'rateDay': exchange.safe_number(data, 3) * 100 * 365,\n            'rateYear': exchange.safe_number(data, 3) * 100 * 365 * 365,\n            'averagePeriod': exchange.safe_number(data, 4),\n            'amount': exchange.safe_number(data, 7),\n            'amountUsed': exchange.safe_number(data, 8),\n            'timestamp': exchange.safe_number(data, 0),\n        }\n    return fundingInfos\n\nasync def bot():\n    fundingInfos = await get_last_funding_infos()\n    for currency in currencies:\n        ms = int(time.time() * 1000)\n\n        order_size = order_sizes[currency]\n        fundingInfo = fundingInfos[currency]\n\n        profit = (fundingInfo['averagePeriod'] * fundingInfo['rateDay'] * order_size) - order_size\n\n        if (profit > 0): # not taking into account slippage or order book depth\n            print(ms, currency, \"profit:\", profit, \"lend:\", currency, \"rate:\", fundingInfo['rate'], \"period (day):\", fundingInfo['averagePeriod'])\n            \n            if not paper_trading:\n                order = await exchange.private_post_auth_w_funding_offer_submit({\n                    'type': 'LIMIT',\n                    'symbol': currency,\n                    'amount': str(order_size),\n                    'rate': str(fundingInfo['rate']),\n                    'period': 2,\n                    'flags': 0\n                })\n        else:\n            print(str(ms), symbol, \"no lending opportunity\")\n\nasync def check_requirements():\n    print(\"Checking if exchange support the currency we want to lend\")\n    await exchange.load_markets()\n    \n    for currency in currencies:\n        if currency not in exchange.currencies_by_id:\n            print(exchange.id, \"does not support\", currency)\n            sys.exit()\n\nasync def main():\n    await check_requirements()\n    print(\"Starting bot\")\n    while True:\n        try:\n            await bot()\n        except e:\n            print(\"Exception: \", e)\n        await asyncio.sleep(wait_time)\n\nasyncio.run(main())",
    "source": "github_repo:ccxt/ccxt",
    "file": "examples/bots/py/bitfinex-lending-bot.py",
    "license": "MIT",
    "language": "python"
}