{
    "code": "import asyncio\nimport httpx\n\n\nasync def call_replicate(input: dict[str, str | int], api_token: str) -> str:\n    headers = {\n        \"Authorization\": f\"Bearer {api_token}\",\n        \"Content-Type\": \"application/json\",\n    }\n\n    data = {\"input\": input}\n\n    async with httpx.AsyncClient() as client:\n        try:\n            response = await client.post(\n                \"https://api.replicate.com/v1/models/black-forest-labs/flux-schnell/predictions\",\n                headers=headers,\n                json=data,\n            )\n            response.raise_for_status()\n            response_json = response.json()\n\n            # Extract the id from the response\n            prediction_id = response_json.get(\"id\")\n            if not prediction_id:\n                raise ValueError(\"Prediction ID not found in initial response.\")\n\n            # Polling every 0.1 seconds until the status is succeeded or error (upto 10s)\n            num_polls = 0\n            max_polls = 100\n            while num_polls < max_polls:\n                num_polls += 1\n\n                await asyncio.sleep(0.1)\n\n                # Check the status\n                status_check_url = (\n                    f\"https://api.replicate.com/v1/predictions/{prediction_id}\"\n                )\n                status_response = await client.get(status_check_url, headers=headers)\n                status_response.raise_for_status()\n                status_response_json = status_response.json()\n                status = status_response_json.get(\"status\")\n\n                # If status is succeeded or if there's an error, break out of the loop\n                if status == \"succeeded\":\n                    return status_response_json[\"output\"][0]\n                elif status == \"error\":\n                    raise ValueError(\n                        f\"Inference errored out: {status_response_json.get('error', 'Unknown error')}\"\n                    )\n                elif status == \"failed\":\n                    raise ValueError(\"Inference failed\")\n\n            # If we've reached here, it means we've exceeded the max number of polls\n            raise TimeoutError(\"Inference timed out\")\n\n        except httpx.HTTPStatusError as e:\n            raise ValueError(f\"HTTP error occurred: {e}\")\n        except httpx.RequestError as e:\n            raise ValueError(f\"An error occurred while requesting: {e}\")\n        except asyncio.TimeoutError:\n            raise TimeoutError(\"Request timed out\")\n        except Exception as e:\n            raise ValueError(f\"An unexpected error occurred: {e}\")",
    "source": "github_repo:abi/screenshot-to-code",
    "file": "backend/image_generation/replicate.py",
    "license": "MIT",
    "language": "python"
}