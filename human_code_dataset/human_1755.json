{
    "code": "# -*- coding: utf-8 -*-\nimport asyncio\nimport ccxt.pro\n\n\nprint('CCXT Version:', ccxt.__version__)\n\n\nasync def loop(exchange, symbol, timeframe, complete_candles_only=False):\n    duration_in_seconds = exchange.parse_timeframe(timeframe)\n    duration_in_ms = duration_in_seconds * 1000\n    while True:\n        try:\n            trades = await exchange.watch_trades(symbol)\n            if len(trades) > 0:\n                current_minute = int(exchange.milliseconds() / duration_in_ms)\n                ohlcvc = exchange.build_ohlcvc(trades, timeframe)\n                if complete_candles_only:\n                    ohlcvc = [candle for candle in ohlcvc if int(candle[0] / duration_in_ms) < current_minute]\n                if len(ohlcvc) > 0:\n                    print('-----------------------------------------------------------')\n                    print(\"Symbol:\", symbol, \"timeframe:\", timeframe)\n                    print(ohlcvc)\n\n        except Exception as e:\n            print(f\"{type(e).__name__}: {(str(e))}\")\n            # raise type(e)(str(e))  # uncomment to break all loops in case of an error in any one of them\n            # break  # you can also break just this one loop if it fails\n\n\nasync def main():\n    # select the exchange\n    exchange = ccxt.pro.binance()\n    if exchange.has['watchTrades']:\n        markets = await exchange.load_markets()\n        # Change this value accordingly\n        timeframe = '1m'\n        limit = 5\n        selected_symbols = list(markets.values())[:limit]\n        # you can also specify the symbols manually\n        # selected_symbols = ['BTC/USDT', 'ETH/USDT']\n\n        # Use this variable to choose if only complete candles\n        # should be considered\n        complete_candles_only = True\n        await asyncio.gather(*[loop(exchange, symbol['symbol'], timeframe, complete_candles_only)\n                               for symbol in selected_symbols])\n        await exchange.close()\n    else:\n        print(exchange.id, 'does not support watchTrades yet')\n\n\nasyncio.run(main())",
    "source": "github_repo:ccxt/ccxt",
    "file": "examples/ccxt.pro/py/build-ohlcv-many-symbols.py",
    "license": "MIT",
    "language": "python"
}