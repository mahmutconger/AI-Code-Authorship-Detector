{
    "code": "def main():\n    inf = json.loads(sys.argv[1])\n    url = inf[\"txt\"]\n    if not url.lower().startswith(\"magnet:?\"):\n        # not a magnet, abort\n        return\n\n    if inf[\"user\"] not in ALLOWLIST:\n        print(\"ðŸ§² denied for user\", inf[\"user\"])\n        return\n\n    # might as well run the command inside the filesystem folder\n    # which matches the URL that the magnet message was sent to\n    os.chdir(inf[\"ap\"])\n\n    # is there is a custom download location in the url?\n    dst = \"\"\n    if \" \" in url:\n        url, dst = url.split(\" \", 1)\n\n        # is the location in the predefined list of locations?\n        parts = dst.replace(\"\\\\\", \"/\").split(\"/\")\n        if parts[0] in DESTS:\n            dst = os.path.join(DESTS[parts[0]], *(parts[1:]))\n\n    else:\n        # nope, so download to the current folder instead;\n        # comment the dst line below to instead use the default\n        # download location from your qbittorrent settings\n        dst = inf[\"ap\"]\n        pass\n\n    # archlinux has a -nox suffix for qbittorrent if headless\n    # so check if we should be using that\n    if shutil.which(\"qbittorrent-nox\"):\n        torrent_bin = \"qbittorrent-nox\"\n    else:\n        torrent_bin = \"qbittorrent\"\n\n    # the command to add a new torrent, adjust if necessary\n    cmd = [torrent_bin, url]\n    if dst:\n        cmd += [\"--save-path=%s\" % (dst,)]\n\n    # if copyparty and qbittorrent are running as different users\n    # you may have to do something like the following\n    # (assuming qbittorrent* is nopasswd-allowed in sudoers):\n    #\n    # cmd = [\"sudo\", \"-u\", \"qbitter\"] + cmd\n\n    print(\"ðŸ§²\", cmd)\n\n    try:\n        sp.check_call(cmd)\n    except:\n        print(\"ðŸ§² FAILED TO ADD\", url)",
    "source": "github_repo:9001/copyparty",
    "file": "bin/hooks/qbittorrent-magnet.py",
    "license": "MIT",
    "language": "python"
}