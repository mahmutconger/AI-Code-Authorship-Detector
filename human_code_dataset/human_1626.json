{
    "code": "class MCPServerAdapter:\n    \"\"\"Manages the lifecycle of an MCP server and make its tools available to CrewAI.\n\n    Note: tools can only be accessed after the server has been started with the\n        `start()` method.\n\n    Attributes:\n        tools: The CrewAI tools available from the MCP server.\n\n    Usage:\n        # context manager + stdio\n        with MCPServerAdapter(...) as tools:\n            # tools is now available\n\n        # context manager + sse\n        with MCPServerAdapter({\"url\": \"http://localhost:8000/sse\"}) as tools:\n            # tools is now available\n\n        # context manager with filtered tools\n        with MCPServerAdapter(..., \"tool1\", \"tool2\") as filtered_tools:\n            # only tool1 and tool2 are available\n\n        # context manager with custom connect timeout (60 seconds)\n        with MCPServerAdapter(..., connect_timeout=60) as tools:\n            # tools is now available with longer timeout\n\n        # manually stop mcp server\n        try:\n            mcp_server = MCPServerAdapter(...)\n            tools = mcp_server.tools  # all tools\n\n            # or with filtered tools and custom timeout\n            mcp_server = MCPServerAdapter(..., \"tool1\", \"tool2\", connect_timeout=45)\n            filtered_tools = mcp_server.tools  # only tool1 and tool2\n            ...\n        finally:\n            mcp_server.stop()\n\n        # Best practice is ensure cleanup is done after use.\n        mcp_server.stop() # run after crew().kickoff()\n    \"\"\"\n\n    def __init__(\n        self,\n        serverparams: StdioServerParameters | dict[str, Any],\n        *tool_names: str,\n        connect_timeout: int = 30,\n    ) -> None:\n        \"\"\"Initialize the MCP Server.\n\n        Args:\n            serverparams: The parameters for the MCP server it supports either a\n                `StdioServerParameters` or a `dict` respectively for STDIO and SSE.\n            *tool_names: Optional names of tools to filter. If provided, only tools with\n                matching names will be available.\n            connect_timeout: Connection timeout in seconds to the MCP server (default is 30s).\n\n        \"\"\"\n        super().__init__()\n        self._adapter = None\n        self._tools = None\n        self._tool_names = list(tool_names) if tool_names else None\n\n        if not MCP_AVAILABLE:\n            import click\n\n            if click.confirm(\n                \"You are missing the 'mcp' package. Would you like to install it?\"\n            ):\n                import subprocess\n\n                try:\n                    subprocess.run([\"uv\", \"add\", \"mcp crewai-tools[mcp]\"], check=True)  # noqa: S607\n\n                except subprocess.CalledProcessError as e:\n                    raise ImportError(\"Failed to install mcp package\") from e\n            else:\n                raise ImportError(\n                    \"`mcp` package not found, please run `uv add crewai-tools[mcp]`\"\n                )\n\n        try:\n            self._serverparams = serverparams\n            self._adapter = MCPAdapt(\n                self._serverparams, CrewAIAdapter(), connect_timeout\n            )\n            self.start()\n\n        except Exception as e:\n            if self._adapter is not None:\n                try:\n                    self.stop()\n                except Exception as stop_e:\n                    logger.error(f\"Error during stop cleanup: {stop_e}\")\n            raise RuntimeError(f\"Failed to initialize MCP Adapter: {e}\") from e\n\n    def start(self):\n        \"\"\"Start the MCP server and initialize the tools.\"\"\"\n        self._tools = self._adapter.__enter__()\n\n    def stop(self):\n        \"\"\"Stop the MCP server.\"\"\"\n        self._adapter.__exit__(None, None, None)\n\n    @property\n    def tools(self) -> ToolCollection[BaseTool]:\n        \"\"\"The CrewAI tools available from the MCP server.\n\n        Raises:\n            ValueError: If the MCP server is not started.\n\n        Returns:\n            The CrewAI tools available from the MCP server.\n        \"\"\"\n        if self._tools is None:\n            raise ValueError(\n                \"MCP server not started, run `mcp_server.start()` first before accessing `tools`\"\n            )\n\n        tools_collection = ToolCollection(self._tools)\n        if self._tool_names:\n            return tools_collection.filter_by_names(self._tool_names)\n        return tools_collection\n\n    def __enter__(self):\n        \"\"\"Enter the context manager. Note that `__init__()` already starts the MCP server.\n        So tools should already be available.\n        \"\"\"\n        return self.tools\n\n    def __exit__(self, exc_type, exc_value, traceback):\n        \"\"\"Exit the context manager.\"\"\"\n        return self._adapter.__exit__(exc_type, exc_value, traceback)",
    "source": "github_repo:crewAIInc/crewAI",
    "file": "lib/crewai-tools/src/crewai_tools/adapters/mcp_adapter.py",
    "license": "MIT",
    "language": "python"
}